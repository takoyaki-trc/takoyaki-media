<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, maximum-scale=1.0">

<style>
/* =========================
   背景：空（あなたのまま）
========================= */
body::before{
  content:"";
  position: fixed;
  inset: 0;
  z-index: -1;
  pointer-events: none;
  background:
    radial-gradient(
      ellipse at center,
      rgba(0,0,0,0) 55%,
      rgba(0,0,0,0.18) 100%
    ),
    var(--sky, linear-gradient(
      #87b8e5 0%,
      #cfe8ff 55%,
      #ffffff 100%
    ));
  transition: background 6s linear;
}

/* =========================
   ✅ centerタグ撤去用：全体センタリング
========================= */
.page-center{
  text-align: center;
}
.page-center img{
  max-width: 100%;
  height: auto;
}

/* =========================
   太陽/月（あなたのまま）
========================= */
.phase-dot.is-active{
  opacity: 1;
  transform: scale(1.0);
  filter: drop-shadow(0 0 6px rgba(255,255,255,0.35));
}
.phase-dot.sun{
  background: radial-gradient(circle at 30% 30%, #fff7c8 0%, #ffd86b 55%, #f2b705 100%);
  box-shadow: 0 0 14px rgba(255,200,80,0.35);
}
.phase-dot.moon{
  background: radial-gradient(circle at 35% 30%, #ffffff 0%, #e6e6e6 70%, #cfcfcf 100%);
}
.phase-dot.moon::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:50%;
  background: rgba(15,20,32,0.95);
  transform: translateX(var(--shadow-x, 0px));
}

/* ===== 太陽／月レール ===== */
#phase-strip{
  position: relative;
  width: 220px;
  height: 54px !important;
  margin: 0 auto 4px !important;
  padding: 0 !important;
}
#phase-orb{
  position: absolute;
  top: 0 !important;
  left: 0;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  image-rendering: pixelated;
  transition:
    transform 0.6s ease,
    filter 0.6s ease,
    background 0.6s ease;
}
#phase-orb.sun{
  background: radial-gradient(circle at 30% 30%, #fff7c8 0%, #ffd86b 55%, #f2b705 100%);
  box-shadow: 0 0 14px rgba(255,200,80,0.35);
  transform: scale(1);
}
#phase-orb.moon{
  background: radial-gradient(circle at 35% 30%, #ffffff 0%, #e6e6e6 70%, #cfcfcf 100%);
  transform: scale(0.8);
}
#phase-orb.moon::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:50%;
  background: rgba(15,20,32,0.95);
  transform: translateX(var(--shadow-x, 0px));
}
@media (max-width:480px){
  #phase-strip{ width: 200px; }
  #phase-orb{ width: 36px; height: 36px; }
}

/* =========================
   ✅ ここが本丸：map-wrapを固定
   - 画像比率で高さが決まる
   - iPhone/PCでズレない
========================= */
.map-wrap{
  position: relative;
  width: min(800px, 100%);
  margin: 0 auto;
  overflow: hidden;

  /* ✅ 背景画像の縦横比に合わせる
     例：背景が 1536×1024 なら 1536/1024
     今は仮で 800/600 にしてるので、合うように調整してOK */
  aspect-ratio: 1536 / 1024;
}

/* ✅ 背景画像を“下敷き”にして座標基準を固定 */
.map-wrap .map-img{
  position: absolute;
  inset: 0;
  width: 100% !important;
  height: 100% !important;
  object-fit: contain; /* coverにすると座標がズレやすい */
  display: block;
  image-rendering: pixelated;
  z-index: 0;
  pointer-events: none;
}

/* ✅ 上に乗るものは全部absoluteで統一（ズレ防止） */
.map-wrap .tf-building,
.map-wrap .hotspot,
.map-wrap .takomin,
.map-wrap .boss-gate,
.map-wrap .spot,
.map-wrap .gate-hit,
.map-wrap .map-gif,
.map-wrap .map2-gif{
  position: absolute;
}

/* ✅ GIFがmap-wrapの高さを押し広げるのを防ぐ */
.map-wrap .map-gif,
.map-wrap .map2-gif{
  z-index: 8;
  width: min(720px, 92%);
  height: auto;
  left: 50%;
  transform: translateX(-50%);
  pointer-events: none; /* 飾りならこれ推奨。タップしたいなら外す */
}

/* GIF位置（好みで調整） */
.map-wrap .map-gif{  top: 42%; }
.map-wrap .map2-gif{ top: 60%; }

/* 建物画像のフィット（あなたのまま強化） */
.map-wrap .tf-building img{
  width: 100%;
  height: auto;
  display: block;
  image-rendering: pixelated;
}

/* 当たり判定（あなたのまま） */
.map-wrap .hotspot{
  display:block;
  cursor:pointer;
  z-index: 50;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}

/* ホバー演出（PC） */
.map-wrap .hotspot:hover{
  outline: 2px solid rgba(255,255,200,0.9);
  box-shadow: 0 0 12px rgba(255,255,200,0.9);
}

/* =========================
   フッター余白潰し（あなたのまま）
========================= */
body.shop #mainFooter.wrapper{ margin-bottom: 0 !important; }
body.shop #mainFooter{ margin: 20px auto 0 !important; padding: 0 !important; }
body.shop #mainFooter .footerMenu ul li{ margin-bottom: 0 !important; }
body.shop #mainFooter.wrapper,
body.shop #mainFooter.wrapper + #base_url{
  margin: 0 !important;
  padding: 0 !important;
}

/* 夜だけ表示制御 */
.night-only{ display:none; }
html.is-night .night-only{ display:block; }
</style>

<!-- ▼ ボスゲート -->
<link rel="stylesheet" href="./assets/css/boss-local.css?v=1">
<!-- ▼ たこ焼き釣り -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/takoyaki-trc/takoyaki-gate@4c8919c0a8740505f80998baea383a228b3bb847/takofish.css">
<!-- ▼ タイトル下のタコ民５０人回し -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/takoyaki-trc/takoyaki-gate@main/takomin-npc2.css?v=789">
<!-- ▼ ホットスポット -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/takoyaki-trc/takoyaki-gate@main/hotspot1.css?v=777">
<!-- ▼たこ焼きの祭壇 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/takoyaki-trc/takoyaki-media@main/town/assets/saidan.css?v=1">
<!-- ▼タコ民村人セリフ -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/takoyaki-trc/takoyaki-gate@main/takomin-murabito.css?v=777">
<!-- ▼ たこ焼きファーム -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/takoyaki-trc/takoyaki-media@main/town/assets/takofarm1.css?v=2">

</head>

<body id="{block:IndexPage}shopTopPage{/block:IndexPage}{block:ItemPage}shopDetailPage{/block:ItemPage}" class="shop template">

<div id="phase-strip">
  <div id="phase-orb"></div>
</div>

<div class="page-center">

  <!-- ▼ タイトル画像 -->
  <img src="https://ul.h3z.jp/h12u4pD5.gif" style="display:block;width:400px !important;height:auto !important;">
  <img src="https://basefile.akamaized.net/takoyakitrc-base-shop/69613a78bcb90/mojiji.png" alt="">

  <!-- タイトル下・タコ民表示 -->
  <div id="takominArea" class="takomin-area">
    <div class="takomin-wrap">
      <a id="takominLink" class="takomin-avatar" href="#" target="_blank" rel="noopener">
        <img id="takominImg" src="" alt="タコ民">
      </a>
      <div class="takomin-text">
        <span id="takominLine">……</span>
      </div>
    </div>
  </div>

  <!-- トースト -->
  <div class="tf-toast" aria-live="polite"></div>

  <!-- ✅ 街マップ -->
  <div class="map-wrap" id="townMap">

    <!-- ✅ 背景（下敷き） -->
    <img
      class="map-img"
      src="https://ul.h3z.jp/0yeAj4R7.png"
      alt="背景"
      data-morning="https://ul.h3z.jp/D4jEiu5y.png"
      data-day="https://ul.h3z.jp/bHkJV3PU.png"
      data-night="https://ul.h3z.jp/EOmNLbDO.png"
    />

    <!-- ✅ 建物：ファーム -->
    <a class="tf-building" href="./farm.html" aria-label="たこ焼き畑へ"
       style="left:18%; top:99%; width:16%;">
      <img src="https://ul.h3z.jp/TmbW4Zix.png" alt="たこ焼き畑（建物）">
    </a>

    <!-- ✅ 建物：露店 -->
    <a class="tf-building" href="./roten.html" aria-label="露店へ"
       style="left:18%; top:93%; width:16%;">
      <img src="https://ul.h3z.jp/yDO66TXg.png" alt="露店（建物）">
    </a>

    <!-- ✅ 建物：図鑑 -->
    <a class="tf-building" href="./zukan.html" aria-label="カード図鑑へ"
       style="left:30%; top:88%; width:14%;">
      <img src="https://ul.h3z.jp/nJLgRZOL.png" alt="カード図鑑（建物）">
    </a>

    <!-- たこ焼きの祭壇（あなたのまま） -->
    <button class="spot spot--gate" type="button" aria-label="たこ焼きゲート（見た目）" style="z-index:20;">
      <img class="spot__base"
           src="https://ul.h3z.jp/DOpnGGIS.png"
           data-day="https://ul.h3z.jp/DOpnGGIS.png"
           data-night="https://ul.h3z.jp/RrfereXw.png"
           alt="たこ焼きの祭壇">
      <img class="spot__icon" src="https://ul.h3z.jp/G9HOojAP.png" alt="行き先アイコン">
    </button>
    <button class="gate-hit" type="button" aria-label="たこ焼きゲート（タップ判定）"></button>

    <div id="gateModal" class="gate-modal" aria-hidden="true">
      <div class="gate-modal__panel" role="dialog" aria-modal="true" aria-labelledby="gateModalTitle">
        <img id="gateModalPhoto" class="gate-modal__photo" src="" alt="">
        <div class="gate-modal__body">
          <div id="gateModalTitle" class="gate-modal__title">たこ焼きゲート</div>
          <div id="gateModalDesc" class="gate-modal__desc"></div>
          <div class="gate-modal__btns">
            <button id="gateModalCancel" type="button" class="gate-modal__btn">やめる</button>
            <a id="gateModalGo" class="gate-modal__btn gate-modal__btn--go" href="#" target="_blank" rel="noopener">行く</a>
          </div>
        </div>
      </div>
    </div>

    <!-- ✅ ボスゲート（夜だけ） -->
    <a class="boss-gate night-only" href="#" aria-label="鉄板魔グマに挑む" style="top:41.3%; left:50%; width:18%; z-index:12;">
      <img src="https://ul.h3z.jp/CsjyEnG3.png" alt="ボスゲート">
    </a>

    <!-- ✅ GIF（ズレ原因を潰した：absolute） -->
    <img src="https://ul.h3z.jp/l2zcjFAE.gif" class="map-gif" alt="コラボカード一覧">
    <img src="https://ul.h3z.jp/OdXwiBmZ.gif" class="map2-gif" alt="たこ焼き菜々">

    <!-- ホットスポット（あなたのまま） -->
    <a class="hotspot hs-osirase" href="https://takoyaki-trc.github.io/takoyaki-media/notice/" aria-label="最新のお知らせ"></a>
    <a class="hotspot hs-story" href="https://ul.h3z.jp/TeAcRjKS.jpg" aria-label="たこ焼きトレカの世界"></a>
    <a class="hotspot hs-situmon" href="https://takoyaki-trc.github.io/takoyaki-media/faq/" aria-label="よくある質問"></a>
    <a class="hotspot hs-bingo" href="ここにURL" aria-label="ビンゴの泉"></a>
    <a class="hotspot hs-ivent" href="ここにURL" aria-label="いま遊べるイベント"></a>
    <a class="hotspot hs-kau" href="https://takoyaki-toreka.booth.pm/" aria-label="カードを買う"></a>
    <a class="hotspot hs-sns" href="https://x.com/takopi_trc" aria-label="たこぴのSNS"></a>
    <a class="hotspot hs-item" href="ここにURL" aria-label="アイテムショップ"></a>
    <a class="hotspot hs-kiroku" href="ここにURL" aria-label="達成の記録"></a>
    <a class="hotspot hs-medhia" href="https://takoyaki-trc.github.io/takoyaki-media/" aria-label="メディア掲載"></a>
    <a class="hotspot hs-korabo" href="ここにURL" aria-label="コラボカードを見る"></a>
    <a class="hotspot hs-zukan1" href="https://ul.h3z.jp/QSIXpYKH.jpg" aria-label="カード図鑑"></a>
    <a class="hotspot hs-tou" href="ここにURL" aria-label="旅路の塔"></a>

    <!-- 協力店ホットスポット -->
    <a class="hotspot hs-ghost" href="https://share.google/zXplullkNy8XP35bj" aria-label="GHOST"></a>
    <a class="hotspot hs-yousha" href="https://share.google/QAtxaPWvWBI4ks2Ug" aria-label="sports and darts cafe YOUSHA"></a>
    <a class="hotspot hs-bigmans" href="https://share.google/K5HRyuWsdxhkIrH7o" aria-label="Darts&Shop BIGMANS"></a>
    <a class="hotspot hs-hanayashiki" href="https://share.google/AOSjhW79YMq0hJUuh" aria-label="華矢式"></a>
    <a class="hotspot hs-2bit" href="https://share.google/N2MqjpCLRYiKU6S8T" aria-label="Darts room 2 bit"></a>
    <a class="hotspot hs-kbc" href="https://share.google/6szp6CoWi6H6kL3Ss" aria-label="ビリヤード＆ダーツＫＢＣ"></a>
    <a class="hotspot hs-mars" href="https://share.google/Nu2j99ORbplos40Zh" aria-label="Mars. Kamata"></a>
    <a class="hotspot hs-dollis" href="https://share.google/gb0NBa7q35HzEfqq9" aria-label="ダーツカフェ ドリズ DOLLiS"></a>
    <a class="hotspot hs-puni" href="https://www.instagram.com/punipuni_wakkanai/" aria-label="ぷにぷに稚内"></a>
    <a class="hotspot hs-katanakazi" href="https://share.google/ulEVNRsi6wreMqV8p" aria-label="たこ焼き 刀鍛冶"></a>
    <a class="hotspot hs-nana" href="https://share.google/MDaHozOZI1bmLxUwL" aria-label="たこ焼き菜々"></a>

    <!-- ※あなたの takomin ボタン群 / boss overlay CSS / JS はそのまま使える
       ここに元のタコ民群ブロックを貼り付けてOK（座標は同じでズレが減る） -->

  </div><!-- /.map-wrap -->

</div><!-- /.page-center -->


<script>
(() => {
  /* ===== Tokyo time ===== */
  function nowTokyo(){
    return new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Tokyo" }));
  }

  /* ===== マップ切替 ===== */
  function slotByHour(h){
    if(h >= 5 && h < 11) return "morning";
    if(h >= 11 && h < 20) return "day";
    return "night";
  }
  function applyMapByHour(h){
    const img = document.querySelector('.map-img');
    if(!img) return;

    const slot = slotByHour(h);
    const url =
      slot === 'morning' ? img.dataset.morning :
      slot === 'day'     ? img.dataset.day :
                           img.dataset.night;

    if(url && img.src !== url) img.src = url;
  }

  /* ===== 空グラデーション ===== */
  const SKY = [
    ["#0b1020", "#141c2e"], ["#0b1020", "#141c2e"],
    ["#0c1224", "#18223a"], ["#121a33", "#22304f"],
    ["#1b2a44", "#3b4a6b"], ["#3c3b5a", "#7b6ea8"],
    ["#8a5a7b", "#f2b5c4"], ["#d97b6a", "#ffd1a9"],
    ["#8ec1e8", "#eaf4ff"], ["#6fa8dc", "#cfe8ff"],
    ["#63a4e1", "#dbeeff"], ["#76b5ea", "#eaf4ff"],
    ["#87b8e5", "#eaf4ff"], ["#87b8e5", "#eaf4ff"],
    ["#7fb3d5", "#eaf4f4"], ["#9fc5d1", "#eaf4f4"],
    ["#f9cb9c", "#fff1c1"], ["#f2a65a", "#f6d365"],
    ["#d96c4f", "#f2a65a"], ["#a35d7b", "#5b4e7a"],
    ["#2c2f4a", "#1b2430"], ["#1b2430", "#141c2e"],
    ["#121a2b", "#10131f"], ["#0b1020", "#141c2e"]
  ];

  const mix = (a,b,t)=>{
    const h=x=>parseInt(x,16);
    const r=x=>x.toString(16).padStart(2,"0");
    const A=a.slice(1).match(/../g).map(h);
    const B=b.slice(1).match(/../g).map(h);
    return "#"+A.map((v,i)=>r(Math.round(v+(B[i]-v)*t))).join("");
  };

  /* ===== 太陽／月 ===== */
  function updatePhaseOrb(now){
    const strip = document.getElementById("phase-strip");
    const orb   = document.getElementById("phase-orb");
    if(!strip || !orb) return;

    const minutes = now.getHours()*60 + now.getMinutes();
    const sunrise = 6*60;
    const sunset  = 19*60;
    const nextSunrise = 24*60 + sunrise;

    let p, isDay;
    if(minutes >= sunrise && minutes < sunset){
      isDay = true;
      p = (minutes - sunrise) / (sunset - sunrise);
    }else{
      isDay = false;
      const m = minutes < sunrise ? minutes + 1440 : minutes;
      p = (m - sunset) / (nextSunrise - sunset);
    }

    const maxX = strip.clientWidth - orb.clientWidth;
    orb.style.transform =
      `translateX(${Math.round(maxX * p)}px) scale(${isDay ? 1 : 0.8})`;

    orb.classList.toggle("sun", isDay);
    orb.classList.toggle("moon", !isDay);

    if(!isDay){
      const sx = Math.round(26 - 52 * p);
      orb.style.setProperty("--shadow-x", `${sx}px`);
    }else{
      orb.style.removeProperty("--shadow-x");
    }
  }

  function applyAll(){
    const now = nowTokyo();
    const h = now.getHours();

    // 夜判定（is-nightへ統一）
    const night = (h >= 20 || h < 5);
    const html = document.documentElement;

    if (night) {
      html.classList.add("is-night");
      html.classList.remove("day");
    } else {
      html.classList.remove("is-night");
      html.classList.add("day");
    }

    applyMapByHour(h);

    // 空グラデーション（分単位なめらか）
    const t = (now.getMinutes()*60 + now.getSeconds()) / 3600;
    const next = (h+1)%24;
    document.body.style.setProperty(
      "--sky",
      `linear-gradient(${mix(SKY[h][0],SKY[next][0],t)}, ${mix(SKY[h][1],SKY[next][1],t)})`
    );

    updatePhaseOrb(now);
  }

  document.addEventListener("DOMContentLoaded", ()=>{
    applyAll();
    setInterval(applyAll, 20 * 1000);
  });
  window.addEventListener("pageshow", applyAll);
})();
</script>

<script defer src="https://cdn.jsdelivr.net/gh/takoyaki-trc/takoyaki-gate@main/takomin-npc2.js?v=111"></script>
<script defer src="./assets/boss1.js?v=2"></script>
<script defer src="https://cdn.jsdelivr.net/gh/takoyaki-trc/takoyaki-gate@main/gate4.js?v=5"></script>
<script defer src="https://cdn.jsdelivr.net/gh/takoyaki-trc/takoyaki-gate@main/takomin-murabito7.js?v=5"></script>
<script defer src="https://cdn.jsdelivr.net/gh/takoyaki-trc/takoyaki-gate@main/takofish11.js?v=2"></script>
<script defer src="./assets/takofarm3.js?v=20260129a"></script>

</body>
</html>


  
