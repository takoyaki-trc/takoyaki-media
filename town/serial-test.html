<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>シリアル redeem テスト</title>
  <style>
    body{ margin:0; font-family:system-ui,-apple-system,"Noto Sans JP",sans-serif; background:#0b0d17; color:#fff; }
    .wrap{ max-width:860px; margin:0 auto; padding:18px 12px 40px; }
    .panel{ background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.14); border-radius:14px; padding:14px; margin:12px 0; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    input{ flex:1; min-width:240px; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.2); background:rgba(0,0,0,.25); color:#fff; font-size:16px; }
    button{ padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.22); background:rgba(255,255,255,.08); color:#fff; font-weight:900; cursor:pointer; }
    button:hover{ background:rgba(255,255,255,.12); }
    pre{ white-space:pre-wrap; word-break:break-word; background:rgba(0,0,0,.35); padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); }
    .muted{ color:rgba(255,255,255,.75); font-size:12px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1 style="margin:6px 0 2px;">シリアル redeem テスト</h1>
    <div class="muted">まずは redeem が通るかだけ確認。seed_token が返ってくればOK。</div>

    <div class="panel">
      <div class="row">
        <input id="code" placeholder="例）TC-GRA-0001" />
        <button id="btn">redeem（送信）</button>
      </div>
      <div class="muted" style="margin-top:10px;">
        ※GASのWebアプリURLを下の <b>API_URL</b> に貼ってから使ってください。
      </div>
    </div>

    <div class="panel">
      <div class="muted" style="margin-bottom:6px;">レスポンス</div>
      <pre id="log">準備OK</pre>
    </div>
  </div>

<script>
  // ✅ ここにGASのWebアプリURLを貼る
  const API_URL = "https://script.google.com/macros/s/AKfycbwXJXFLCgL7ZMgb7M1hHwfKI6vBPicWgf0yutF5qyo9fkLrGH393zSoA20sRqk7PO71/exec";

  // ✅ GAS側のCONFIG.API_KEYと同じにする
  const API_KEY = "takopi-gratan-2026";

  const logEl = document.getElementById("log");
  const codeEl = document.getElementById("code");

  function log(x){
    logEl.textContent = (typeof x === "string") ? x : JSON.stringify(x, null, 2);
  }

  async function apiPost(payload){
    const res = await fetch(API_URL, {
      method:"POST",
      body: JSON.stringify({ apiKey: API_KEY, ...payload })
    });
    return await res.json();
  }

  document.getElementById("btn").onclick = async () => {
    const code = codeEl.value.trim();
    if(!code) return log("コードを入力してください");

    log("redeem中...");
    try{
      const data = await apiPost({ action:"redeem", code });
      log(data);
    }catch(e){
      log("通信エラー: " + e);
    }
  };
</script>
</body>
</html>
