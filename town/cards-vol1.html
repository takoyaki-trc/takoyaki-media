<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>„Ç´„Éº„Éâ„É™„Çπ„ÉàÔΩúÁ¨¨1ÂºæÔºàTN-001„ÄúTN-050Ôºâ</title>
<meta name="description" content="ÁÑº„Åã„Çå„Åü‰ºùË™¨ „Åü„ÅìÁÑº„Åç„Éà„É¨„Éº„Éá„Ç£„É≥„Ç∞„Ç´„Éº„Éâ Á¨¨1Âºæ„Ç´„Éº„Éâ„É™„Çπ„ÉàÔºàÂÖ¨Âºè‰∏ÄË¶ßÔºâ„ÄÇTN-001„ÄúTN-025=Â∫óÈ†≠„ÄÅTN-026„ÄúTN-050=BOOTH„ÄÇ" />

<style>
:root{
  --bg:#0b0d17;
  --panel:rgba(255,255,255,.08);
  --panel2:rgba(255,255,255,.12);
  --line:rgba(255,255,255,.14);
  --text:#fff;
  --muted:rgba(255,255,255,.72);
  --shadow:0 18px 55px rgba(0,0,0,.55);
  --radius:18px;
  --radius2:14px;
  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
  --focus: rgba(160,220,255,.40);
  --glow: 0 10px 35px rgba(80,190,255,.14);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif;
  color:var(--text);
  background:
    radial-gradient(1200px 700px at 50% -10%, rgba(80,190,255,.18), transparent 60%),
    radial-gradient(900px 600px at 10% 20%, rgba(255,170,80,.10), transparent 60%),
    radial-gradient(900px 600px at 90% 40%, rgba(200,120,255,.08), transparent 60%),
    linear-gradient(180deg, #070815 0%, #0b0d17 55%, #070815 100%);
  overflow-x:hidden;
}
body:before{
  content:"";
  position:fixed; inset:0;
  pointer-events:none;
  opacity:.06;
  background-image:
    repeating-linear-gradient(0deg, rgba(255,255,255,.18), rgba(255,255,255,.18) 1px, transparent 1px, transparent 3px);
  mix-blend-mode: overlay;
}

/* ===== Header ===== */
header{
  position: sticky;
  top:0;
  z-index:10;
  padding: calc(14px + env(safe-area-inset-top)) 14px 12px;
  background: linear-gradient(180deg, rgba(7,8,21,.92), rgba(7,8,21,.70));
  border-bottom:1px solid rgba(255,255,255,.10);
  backdrop-filter: blur(10px);
}
.head-inner{
  max-width:1100px;
  margin:0 auto;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.left{
  display:flex;
  align-items:center;
  gap:10px;
  min-width:0;
}
.back{
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.08);
  color: var(--text);
  border-radius: 12px;
  padding: 10px 12px;
  font-weight: 900;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
}
.back:active{ transform: translateY(1px); }
.titlebox{
  min-width:0;
  display:flex;
  flex-direction:column;
  gap:2px;
}
.titlebox .title{
  font-size:16px;
  font-weight:1000;
  letter-spacing:.02em;
  line-height:1.2;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.titlebox .sub{
  font-size:12px;
  color:var(--muted);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.right{ display:flex; align-items:center; gap:10px; }
.btn{
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.12);
  color:#fff;
  border-radius:12px;
  padding:10px 12px;
  font-weight:900;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
}
.btn:active{ transform: translateY(1px); }

/* ===== Layout ===== */
main{
  max-width:1100px;
  margin:0 auto;
  padding: 14px 14px calc(18px + env(safe-area-inset-bottom));
  display:grid;
  gap:12px;
}
.panel{
  background: var(--panel);
  border:1px solid rgba(255,255,255,.14);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  overflow:hidden;
}
.top-panel{
  padding:12px;
  display:grid;
  gap:10px;
}
.meta-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
}
.pill{
  display:inline-flex;
  align-items:center;
  gap:8px;
  font-weight:1000;
  font-size:12px;
  padding:8px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.18);
}
.pill .dot{
  width:8px; height:8px; border-radius:999px;
  background: rgba(160,220,255,.95);
  box-shadow: 0 0 18px rgba(160,220,255,.65);
}
.stat{
  font-family: var(--mono);
  font-size:11px;
  color: rgba(255,255,255,.78);
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  padding: 6px 10px;
  border-radius: 999px;
  white-space:nowrap;
}

.controls{
  display:grid;
  grid-template-columns:1fr;
  gap:10px;
}
.search{
  display:flex;
  gap:8px;
  align-items:center;
  background: rgba(0,0,0,.18);
  border: 1px solid rgba(255,255,255,.10);
  border-radius: 14px;
  padding: 10px;
}
.search input{
  width:100%;
  border:none;
  outline:none;
  background:transparent;
  color:#fff;
  font-size:14px;
  font-weight:800;
}
.search input::placeholder{ color: rgba(255,255,255,.55); font-weight:800; }

.chipbar{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}
.chip{
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.08);
  color:#fff;
  border-radius:999px;
  padding:8px 10px;
  font-weight:1000;
  font-size:12px;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
  user-select:none;
}
.chip.active{
  border-color: rgba(160,220,255,.35);
  background: linear-gradient(180deg, rgba(160,220,255,.22), rgba(160,220,255,.12));
  box-shadow: var(--glow);
}
.chip:active{ transform: translateY(1px); }

.grid-panel{ padding:12px; }
.grid{
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap:10px;
}
@media (min-width:560px){ .grid{ grid-template-columns: repeat(3, 1fr); } }
@media (min-width:900px){ .grid{ grid-template-columns: repeat(4, 1fr); } }

.card{
  border:1px solid rgba(255,255,255,.14);
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
  border-radius:16px;
  overflow:hidden;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
  box-shadow: 0 14px 40px rgba(0,0,0,.28);
  display:grid;
  grid-template-rows:auto 1fr;
  min-height:200px;
  transition: transform .10s ease, border-color .10s ease;
  position:relative;
}
.card:hover{ border-color: rgba(160,220,255,.30); }
.card:active{ transform: scale(.995); }

.thumb{
  position:relative;
  width:100%;
  aspect-ratio: 3/4;
  background: rgba(0,0,0,.22);
  overflow:hidden;
}
.thumb img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

.ribbon{
  position:absolute;
  top:10px;
  left:10px;
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 8px;
  border-radius:999px;
  font-weight:1000;
  font-size:11px;
  color:#fff;
  background: rgba(0,0,0,.55);
  border:1px solid rgba(255,255,255,.16);
  backdrop-filter: blur(6px);
}
.ribbon .dot{
  width:8px; height:8px; border-radius:999px;
  background: rgba(160,220,255,.95);
  box-shadow: 0 0 18px rgba(160,220,255,.6);
}
.ribbon.shop .dot{ background: rgba(255,210,120,.95); box-shadow: 0 0 18px rgba(255,210,120,.55); }
.ribbon.booth .dot{ background: rgba(160,255,200,.95); box-shadow: 0 0 18px rgba(160,255,200,.55); }

.info{
  padding:10px 10px 12px;
  display:grid;
  gap:6px;
}
.no{
  font-family: var(--mono);
  font-size:11px;
  color: rgba(255,255,255,.78);
  letter-spacing:.02em;
}
.name{
  font-size:13px;
  font-weight:1000;
  line-height:1.25;
  letter-spacing:.01em;
}

.empty{
  padding:14px;
  color: var(--muted);
  font-weight:900;
  text-align:center;
  border: 1px dashed rgba(255,255,255,.22);
  border-radius: 16px;
  background: rgba(0,0,0,.12);
  display:none;
}

/* ===== Modal ===== */
.modal-bg{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  padding:16px;
  z-index:100;
  background: rgba(0,0,0,.62);
  backdrop-filter: blur(8px);
}
.modal-bg.open{ display:flex; }

.modal{
  width:min(560px, 100%);
  border-radius:18px;
  border: 1px solid rgba(255,255,255,.16);
  background:
    radial-gradient(900px 400px at 50% 0%, rgba(80,190,255,.14), transparent 62%),
    linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
  box-shadow: 0 22px 80px rgba(0,0,0,.65);
  overflow:hidden;
  transform: translateY(10px) scale(.985);
  opacity:0;
  transition: transform .14s ease, opacity .14s ease;
}
.modal-bg.open .modal{ transform: translateY(0) scale(1); opacity:1; }

.modal-head{
  padding:14px 14px 10px;
  border-bottom: 1px solid rgba(255,255,255,.12);
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:10px;
}
.modal-title{
  display:flex;
  flex-direction:column;
  gap:4px;
  min-width:0;
}
.modal-title .h{
  font-size:16px;
  font-weight:1000;
  letter-spacing:.02em;
  line-height:1.2;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.modal-title .p{
  font-size:12px;
  color: var(--muted);
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  align-items:center;
}
.tag{
  font-family: var(--mono);
  font-size:11px;
  color: rgba(255,255,255,.78);
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  padding: 4px 8px;
  border-radius: 999px;
  white-space: nowrap;
}
.xbtn{
  border:1px solid rgba(255,255,255,.16);
  background: rgba(0,0,0,.18);
  color:#fff;
  border-radius:12px;
  width:42px;
  height:42px;
  font-size:18px;
  font-weight:1000;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
}
.xbtn:active{ transform: translateY(1px); }

.modal-body{
  padding:14px;
  display:grid;
  gap:12px;
}
.bigimg{
  width:100%;
  aspect-ratio: 3/4;
  border-radius:16px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.20);
}
.bigimg img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}
.actions{
  display:grid;
  gap:10px;
}
.primary{
  border:1px solid rgba(160,220,255,.35);
  background: linear-gradient(180deg, rgba(160,220,255,.22), rgba(160,220,255,.12));
  box-shadow: var(--glow);
  border-radius:14px;
  padding:14px 12px;
  font-weight:1000;
  color:#fff;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
  text-align:center;
  text-decoration:none;
}
.ghost{
  border:1px solid rgba(255,255,255,.16);
  background: rgba(255,255,255,.08);
  border-radius:14px;
  padding:12px 10px;
  font-weight:1000;
  color:#fff;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
  text-align:center;
}
.primary:active,.ghost:active{ transform: translateY(1px); }

.toast{
  position: fixed;
  left: 12px;
  right: 12px;
  bottom: calc(14px + env(safe-area-inset-bottom));
  z-index: 200;
  pointer-events:none;
  opacity:0;
  transform: translateY(10px) scale(.98);
  transition: opacity .16s ease, transform .18s ease;
  padding: 12px 12px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.72);
  color: #fff;
  font-weight: 900;
  letter-spacing:.02em;
  text-align:center;
  box-shadow: 0 16px 60px rgba(0,0,0,.55);
}
.toast.show{ opacity:1; transform: translateY(0) scale(1); }

button:focus-visible, input:focus-visible{
  outline: 3px solid var(--focus);
  outline-offset: 2px;
}
</style>
</head>

<body>
<header>
  <div class="head-inner">
    <div class="left">
      <button id="backBtn" class="back" type="button" aria-label="Êàª„Çã">‚Üê</button>
      <div class="titlebox">
        <div class="title">„Ç´„Éº„Éâ„É™„Çπ„ÉàÔºöÁ¨¨1Âºæ</div>
        <div class="sub">TN-001„ÄúTN-025ÔºùÂ∫óÈ†≠ / TN-026„ÄúTN-050ÔºùBOOTHÔºàÂÖ¨Âºè‰∏ÄË¶ßÔºâ</div>
      </div>
    </div>
    <div class="right">
      <button id="helpBtn" class="btn" type="button" aria-label="„Éò„É´„Éó">Ôºü</button>
    </div>
  </div>
</header>

<main>
  <section class="panel top-panel">
    <div class="meta-row">
      <div class="pill"><span class="dot"></span> Á¨¨1ÂºæÔºàÂÖ¨Âºè„Ç´„Éº„Éâ„É™„Çπ„ÉàÔºâ</div>
      <div id="statLine" class="stat">loading...</div>
    </div>

    <div class="controls">
      <div class="search">
        <input id="q" type="search" placeholder="Ê§úÁ¥¢Ôºö„Ç´„Éº„ÉâÂêç / TN-Áï™Âè∑Ôºà‰æãÔºöTN-025Ôºâ" autocomplete="off" />
      </div>

      <div class="chipbar" aria-label="„Éï„Ç£„É´„Çø">
        <button class="chip active" data-rarity="ALL" type="button">ÂÖ®„Å¶</button>
        <button class="chip" data-rarity="N" type="button">N</button>
        <button class="chip" data-rarity="R" type="button">R</button>
        <button class="chip" data-rarity="SR" type="button">SR</button>
        <button class="chip" data-rarity="UR" type="button">UR</button>
        <button class="chip" data-rarity="LR" type="button">LR</button>

        <span style="width:10px;display:inline-block;"></span>

        <button class="chip active" data-place="ALL" type="button">Â∫óÈ†≠ÔºãÈÄöË≤©</button>
        <button class="chip" data-place="SHOP" type="button">Â∫óÈ†≠Ôºà001-025Ôºâ</button>
        <button class="chip" data-place="BOOTH" type="button">BOOTHÔºà026-050Ôºâ</button>
      </div>
    </div>
  </section>

  <section class="panel grid-panel">
    <div id="grid" class="grid" aria-label="„Ç´„Éº„Éâ‰∏ÄË¶ß"></div>
    <div id="empty" class="empty">Ë©≤ÂΩì„Ç´„Éº„Éâ„ÅåË¶ã„Å§„Åã„Çâ„Å™„ÅÑ‚Ä¶ÔºàÊ§úÁ¥¢Êù°‰ª∂„ÇíÂ§â„Åà„Å¶„Åø„Å¶Ôºâ</div>
  </section>
</main>

<!-- Ë©≥Á¥∞„É¢„Éº„ÉÄ„É´ -->
<div id="modalBg" class="modal-bg" role="presentation" aria-hidden="true">
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="mTitle">
    <div class="modal-head">
      <div class="modal-title">
        <div id="mTitle" class="h">-</div>
        <div class="p">
          <span id="mNo" class="tag">-</span>
          <span id="mRarity" class="tag">-</span>
          <span id="mPlace" class="tag">-</span>
        </div>
      </div>
      <button id="mCloseX" class="xbtn" type="button" aria-label="Èñâ„Åò„Çã">√ó</button>
    </div>

    <div class="modal-body">
      <div class="bigimg"><img id="mImg" alt="„Ç´„Éº„ÉâÁîªÂÉè" /></div>
      <div class="actions">
        <a id="openImg" class="primary" href="#" target="_blank" rel="noopener">ÁîªÂÉè„ÇíÂà•„Çø„Éñ„ÅßÈñã„Åè</a>
        <button id="mClose" class="ghost" type="button">Èñâ„Åò„Çã</button>
      </div>
    </div>
  </div>
</div>

<div id="toast" class="toast" aria-live="polite" aria-atomic="true"></div>

<script>
(() => {
  "use strict";

  // =========================
  // Ë®≠ÂÆö
  // =========================
  const CONFIG = {
    // „Åì„Åì„Çí„ÅÇ„Å™„Åü„ÅÆÂ∞éÁ∑ö„Å´Âêà„Çè„Åõ„Å¶Â§â„Åà„Å¶OK
    BACK_URL: "./index.html", // ‰æãÔºöË°ó„Éû„ÉÉ„Éó„Å´Êàª„Çã
  };

  // =========================================================
  // „Ç´„Éº„Éâ„Éó„Éº„É´ÔºàÁúÅÁï•„Å™„Åó„ÉªÂÖ®ÈÉ®Ôºâ
  // =========================================================
  const CARD_POOLS = {
    N: [
      { no:"TN-005", name:"„Åü„ÅìÁÑº„Åç„Çø„ÉØ„Éº112", img:"https://ul.h3z.jp/LoXMSiYd.jpg" },
      { no:"TN-006", name:"Â°©È°î„Éë„É¨„Éº„ÉâÁÑº„Åç", img:"https://ul.h3z.jp/7L7rcrnM.jpg" },
      { no:"TN-009", name:"Â°©„Éû„É®Èú≤Â§©ÁÑº„Åç", img:"https://ul.h3z.jp/bF9QmTE8.jpg" },
      { no:"TN-011", name:"„ÉÅ„Éº„Ç∫ÁÅ´Â±±ÁÑº„Åç", img:"https://ul.h3z.jp/BEj3BIcP.jpg" },
      { no:"TN-012", name:"Êèö„ÅíÁéâ‰ºöË≠∞ÁÑº„Åç", img:"https://ul.h3z.jp/vVw2FjQp.jpg" },
      { no:"TN-013", name:"„Åè„Åü„Å≥„ÇåÂ°©„Åì„Åó„Çá„ÅÜÁÑº„Åç", img:"https://ul.h3z.jp/DlX5pLJ5.jpg" },
      { no:"TN-016", name:"„Åü„ÅìÁÑº„Åç„ÄÅÁô∫Â∞Ñ„Ç™„Éº„É©„Ç§", img:"https://ul.h3z.jp/50WYMkYw.jpg" },
      { no:"TN-018", name:"„ÇÜ„ÅÆ„Åã„Çè„ÅÆ‰∏ª", img:"https://ul.h3z.jp/mkLBMxIT.jpg" },
      { no:"TN-019", name:"Ë™§ÂÖ•Â∫ó„Éà„É©„ÉÉ„Éó", img:"https://ul.h3z.jp/YfON5rBJ.jpg" },
      { no:"TN-021", name:"„Åü„ÅìÁÑº„Åç„ÄÅÊµÅ„Çå„Å¶ÂÄô", img:"https://ul.h3z.jp/O4s1VpWd.jpg" },
      { no:"TN-023", name:"ËäùÁîü„Åã„Åü„ÅìÁÑº„Åç„ÅãÂ§ß‰ºö", img:"https://ul.h3z.jp/FZcOaXY8.jpg" },
      { no:"TN-024", name:"Ê∏©Ê≥âÂ•≥Á•û„ÅÆ„ÅÇ„Çä„Åå„ÅüËø∑ÊÉë", img:"https://ul.h3z.jp/A6WhBsqj.jpg" },
      { no:"TN-026", name:"„Åü„ÅìÁÑº„Åç48Âõû„É™„ÉúÊâï„ÅÑ", img:"https://ul.h3z.jp/hz7JXyky.jpg" },
      { no:"TN-027", name:"ÂÖ®Ë∫´„Åü„ÅìÁÑº„Åç„ÉÄ„Ç§„Ç®„ÉÉ„Éà", img:"https://ul.h3z.jp/FQ3poZLg.jpg" },
      { no:"TN-028", name:"Ëá™Â∑±ÂïìÁô∫„Åü„ÅìÂ°æ„Ää‰∫ï‰∏äË´í„Éó„É≠üéØ„Äã", img:"https://ul.h3z.jp/sPChFFlG.jpg" },
      { no:"TN-029", name:"„Ç´„É≠„É™„Éº„Çº„É≠ÁêÜË´ñ„Ää‰ªÅÊú®Ê≤ª„Éó„É≠üéØ„Äã", img:"https://ul.h3z.jp/4HEbt3YP.jpg" },
      { no:"TN-031", name:"Ë°åÂàó„ÅÆÊúÄÂæåÂ∞æ„ÅåÂà•Áúå", img:"https://ul.h3z.jp/LBdFqlLI.jpg" },
      { no:"TN-034", name:"„Ç®„Ç∑„Ç´„É´ÈÅéÂâ∞ÁÑº„Åç", img:"https://ul.h3z.jp/KRkSq4WD.jpg" },
      { no:"TN-036", name:"„Éû„É®„Éç„Éº„Ç∫Ë©êÊ¨∫", img:"https://ul.h3z.jp/NzVgPYdG.jpg" },
      { no:"TN-037", name:"ÂãòÈÅï„ÅÑ„Éá„Éº„Éà", img:"https://ul.h3z.jp/riYYAnEi.jpg" },
      { no:"TN-041", name:"Áéâ„ÅÆ‰∏ä„Å´„ÇÇ‰∏âÂπ¥", img:"https://ul.h3z.jp/pQg0jZMy.jpg" },
      { no:"TN-043", name:"Ëª¢Áîü„Åó„Åü„ÇâÂç≥Â£≤„Çå„Åü„ÅìÁÑº„Åç", img:"https://ul.h3z.jp/I3JWnpoL.jpg" },
      { no:"TN-046", name:"„Åî„Åæ„Åô„Çä„Åü„ÅìÁÑº„Åç", img:"https://ul.h3z.jp/tuLsTiaz.jpg" },
      { no:"TN-048", name:"Â∫ó‰∏ªÂèçÊíÉ„É¨„Éì„É•„Éº„Ää‰Ωê‰ø£ÈõÑ‰∏ÄÈÉéüéØ„Äã", img:"https://ul.h3z.jp/ge8b4cQ5.jpg" },
    ],
    R: [
      { no:"TN-002", name:"ÁÜ±„ÄÖÂú∞ÁçÑ„ÅÆÁµ¶„Åü„ÅìÊâÄ", img:"https://ul.h3z.jp/otr0dAQi.jpg" },
      { no:"TN-003", name:"ÁàÜËµ∞ÔºÅ„Åü„ÅìÁÑº„Åç„É©„Ç§„ÉÄ„ÉºËèú„ÄÖ", img:"https://ul.h3z.jp/06HrUPMT.jpg" },
      { no:"TN-008", name:"ÊòéÂ§™„ÇÆ„É£„É©„ÇØ„Ç∑„ÉºÁÑº„Åç", img:"https://ul.h3z.jp/xye1uAfV.jpg" },
      { no:"TN-014", name:"‰∏ñÁïå„Åü„ÅìÁÑº„ÅçÈá£„ÇäÈÅ∏ÊâãÊ®©Â§ß‰ºö", img:"https://ul.h3z.jp/cyekwiam.jpg" },
      { no:"TN-017", name:"„Åü„ÅìÁÑº„Åç„Éû„Éã„Éï„Çß„Çπ„Éà", img:"https://ul.h3z.jp/zeSwFyjz.jpg" },
      { no:"TN-022", name:"„Åü„ÅìÁÑº„Åç„ÉÄ Attach-Inferno„ÄäÂ∞çÈ¶¨Ë£ï‰Ω≥Â≠ê„Éó„É≠üéØ„Äã", img:"https://ul.h3z.jp/Prf7KxRk.jpg" },
      { no:"TN-032", name:"ÂõΩÂ¢ÉË∂Ö„Åà„ÅüÊÅã", img:"https://ul.h3z.jp/9AZcVNmR.jpg" },
      { no:"TN-035", name:"„Éá„É™„Éê„É™„ÉºÈï∑Ë∑ùÈõ¢‰æø", img:"https://ul.h3z.jp/z0xhODVy.jpg" },
      { no:"TN-038", name:"ÊÅãËêΩ„Å°„Éû„ÉÉ„ÉÅ„É≥„Ç∞", img:"https://ul.h3z.jp/BPEoWjuY.jpg" },
      { no:"TN-042", name:"„Åü„ÅìÁÑº„Åç„É´„Éº„Éó„Ç∂„É´„Éº„Éó", img:"https://ul.h3z.jp/vxKamb6f.jpg" },
      { no:"TN-044", name:"ÁôΩ„ÅÑÂ•ëÁ¥Ñ(Á®≤Áü≥Ë£ï„Éó„É≠üéØ)", img:"https://ul.h3z.jp/bC1B4WkQ.jpg" },
      { no:"TN-047", name:"„Éú„Çπ„Ç≤„Éº„Éà", img:"https://ul.h3z.jp/GHWrtaYk.jpg" },
    ],
    SR: [
      { no:"TN-004", name:"Ë¶ã„Åà„Çã„Éï„É™ÁÑº„Åç", img:"https://ul.h3z.jp/irs6Sxoy.jpg" },
      { no:"TN-010", name:"ÁÑº„ÇØËÄÖ„ÉéË®º", img:"https://ul.h3z.jp/6A2LOn4A.jpg" },
      { no:"TN-015", name:"È°î„Ç≥„Ç§„É≥", img:"https://ul.h3z.jp/7GUyGDU1.jpg" },
      { no:"TN-020", name:"„Éî„ÉÉ„ÇØ‰∏çË¶Å„ÅÆÁúüÂÆü", img:"https://ul.h3z.jp/Bu1pk4ul.jpg" },
      { no:"TN-030", name:"„Ç¨„ÉÅ„É£„Åü„ÅìÁÑº„Åç", img:"https://ul.h3z.jp/kFpjcqSv.jpg" },
      { no:"TN-039", name:"„Éâ„É≠„Éº„É≥Ë™§ÈÖçÈÅî", img:"https://ul.h3z.jp/70A10oHf.jpg" },
      { no:"TN-040", name:"Êé®„ÅóÊ¥ª„Åü„ÅìÂõ£Êâá", img:"https://ul.h3z.jp/jY5MVsrt.jpg" },
      { no:"TN-049", name:"„Åü„ÅìÁÑº„Åç„ÅÆÂæ°Á•û‰Ωì", img:"https://ul.h3z.jp/GQ8H0lGq.jpg" },
    ],
    UR: [
      { no:"TN-001", name:"Èªí„ÅçÁúüÁè†„Ç§„Ç´„Åï„ÅæÁÑº„Åç", img:"https://ul.h3z.jp/2KeO7gmu.jpg" },
      { no:"TN-007", name:"„É≠„Éº„ÇΩ„ÇØÂá∫„ÅõÔºÅ", img:"https://ul.h3z.jp/FI5xXdQ7.jpg" },
      { no:"TN-033", name:"ÈâÑÊùø„ÅÆ„Éì„Éº„Éä„Çπ", img:"https://ul.h3z.jp/0Tvf0Asc.jpg" },
      { no:"TN-045", name:"„Éâ„É™„Éº„É†„Éï„Ç°„Ç§„Éà", img:"https://ul.h3z.jp/IzPy6UsO.jpg" },
    ],
    LR: [
      { no:"TN-025", name:"„Åü„ÅìÁÑº„ÅçÂåñÁü≥inÂáΩÈ§®Â±±", img:"https://ul.h3z.jp/BR1X7scb.png" },
      { no:"TN-050", name:"ÁÑº„Åã„Çå„ÅóË®òÊÜ∂„ÄÅ„ÇΩ„Éº„Çπ„Å´ÈÇÑ„Çã", img:"https://ul.h3z.jp/0I6s0icl.jpg" },
    ],
  };

  // =========================
  // DOM
  // =========================
  const $ = (q) => document.querySelector(q);
  const $$ = (q) => Array.from(document.querySelectorAll(q));

  const backBtn = $("#backBtn");
  const helpBtn = $("#helpBtn");
  const statLine = $("#statLine");
  const qInput = $("#q");
  const grid = $("#grid");
  const empty = $("#empty");

  const modalBg = $("#modalBg");
  const mCloseX = $("#mCloseX");
  const mClose = $("#mClose");
  const mTitle = $("#mTitle");
  const mNo = $("#mNo");
  const mRarity = $("#mRarity");
  const mPlace = $("#mPlace");
  const mImg = $("#mImg");
  const openImg = $("#openImg");

  const toastEl = $("#toast");

  // =========================
  // toast
  // =========================
  let toastTimer = null;
  function toast(msg){
    clearTimeout(toastTimer);
    toastEl.textContent = msg;
    toastEl.classList.add("show");
    toastTimer = setTimeout(() => toastEl.classList.remove("show"), 1400);
  }

  // =========================
  // Utils
  // =========================
  const RARITY_ORDER = ["N","R","SR","UR","LR"];

  function parseNum(no){
    const m = String(no).match(/(\d{1,4})/);
    return m ? parseInt(m[1], 10) : NaN;
  }
  function placeOf(no){
    const n = parseNum(no);
    if (!Number.isFinite(n)) return "UNKNOWN";
    if (n >= 1 && n <= 25) return "SHOP";
    if (n >= 26 && n <= 50) return "BOOTH";
    return "UNKNOWN";
  }
  function placeLabel(place){
    if(place==="SHOP") return "Â∫óÈ†≠";
    if(place==="BOOTH") return "BOOTH";
    return "‰∏çÊòé";
  }
  function normalize(s){
    return String(s || "")
      .toLowerCase()
      .replace(/\s+/g,"")
      .replace(/„ÄÄ+/g,"");
  }
  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, (m) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }

  // =========================
  // Flatten
  // =========================
  function buildFlat(){
    const out = [];
    for (const r of RARITY_ORDER){
      const arr = CARD_POOLS[r] || [];
      for (const c of arr){
        out.push({
          rarity: r,
          no: c.no,
          name: c.name,
          img: c.img,
          num: parseNum(c.no),
          place: placeOf(c.no),
        });
      }
    }
    out.sort((a,b) => (a.num - b.num) || (RARITY_ORDER.indexOf(a.rarity) - RARITY_ORDER.indexOf(b.rarity)));
    return out;
  }
  const ALL = buildFlat();

  // =========================
  // State
  // =========================
  const state = {
    rarity: "ALL",
    place: "ALL",
    q: "",
  };

  // =========================
  // Chips
  // =========================
  const rarityChips = $$(".chip[data-rarity]");
  const placeChips  = $$(".chip[data-place]");

  function setActiveChip(list, predicate){
    for (const el of list){
      el.classList.toggle("active", predicate(el));
    }
  }

  rarityChips.forEach(el => {
    el.addEventListener("click", () => {
      state.rarity = el.dataset.rarity;
      setActiveChip(rarityChips, x => x.dataset.rarity === state.rarity);
      render();
    });
  });

  placeChips.forEach(el => {
    el.addEventListener("click", () => {
      state.place = el.dataset.place;
      setActiveChip(placeChips, x => x.dataset.place === state.place);
      render();
    });
  });

  qInput.addEventListener("input", () => {
    state.q = qInput.value || "";
    render();
  });

  // =========================
  // Modal
  // =========================
  let lastFocus = null;

  function openModal(card){
    lastFocus = document.activeElement;

    mTitle.textContent = card.name;
    mNo.textContent = card.no;
    mRarity.textContent = `RARITY:${card.rarity}`;
    mPlace.textContent = placeLabel(card.place);

    mImg.src = card.img;
    mImg.alt = `${card.name}Ôºà${card.no}Ôºâ`;
    openImg.href = card.img;

    modalBg.classList.add("open");
    modalBg.setAttribute("aria-hidden","false");
    setTimeout(() => mCloseX.focus({preventScroll:true}), 10);
  }

  function closeModal(){
    modalBg.classList.remove("open");
    modalBg.setAttribute("aria-hidden","true");
    if (lastFocus && typeof lastFocus.focus === "function"){
      setTimeout(() => lastFocus.focus({preventScroll:true}), 10);
    }
  }

  modalBg.addEventListener("click", (e) => {
    if (e.target === modalBg) closeModal();
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && modalBg.classList.contains("open")){
      e.preventDefault();
      closeModal();
    }
  });

  mCloseX.addEventListener("click", closeModal);
  mClose.addEventListener("click", closeModal);

  // =========================
  // Render
  // =========================
  function filtered(){
    const nq = normalize(state.q);

    return ALL.filter(c => {
      if (state.rarity !== "ALL" && c.rarity !== state.rarity) return false;
      if (state.place !== "ALL" && c.place !== state.place) return false;

      if (nq){
        const hay = normalize(`${c.no} ${c.name} ${c.rarity} ${placeLabel(c.place)}`);
        if (!hay.includes(nq)) return false;
      }
      return true;
    });
  }

  function render(){
    const list = filtered();
    const total = ALL.length;
    const shown = list.length;

    statLine.textContent = `Ë°®Á§∫:${shown}/${total}ÔºàÂÖ¨ÂºèÔºâ`;

    grid.innerHTML = "";
    empty.style.display = (shown === 0) ? "block" : "none";

    for (const c of list){
      const place = c.place;
      const ribbonClass = place === "SHOP" ? "ribbon shop" : (place === "BOOTH" ? "ribbon booth" : "ribbon");
      const ribbonText  = place === "SHOP" ? "Â∫óÈ†≠" : (place === "BOOTH" ? "BOOTH" : "‰∏çÊòé");

      const card = document.createElement("div");
      card.className = "card";
      card.setAttribute("role","button");
      card.setAttribute("tabindex","0");
      card.setAttribute("aria-label", `${c.no} ${c.name} „ÇíÈñã„Åè`);

      card.innerHTML = `
        <div class="thumb">
          <img loading="lazy" decoding="async" src="${c.img}" alt="${escapeHtml(c.name)}">
          <div class="${ribbonClass}"><span class="dot"></span>${ribbonText}</div>
        </div>
        <div class="info">
          <div class="no">${c.no} / ${c.rarity}</div>
          <div class="name">${escapeHtml(c.name)}</div>
        </div>
      `;

      const open = () => openModal(c);
      card.addEventListener("click", open);
      card.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " "){
          e.preventDefault();
          open();
        }
      });

      grid.appendChild(card);
    }
  }

  // =========================
  // Header buttons
  // =========================
  backBtn.addEventListener("click", () => location.href = CONFIG.BACK_URL);
  helpBtn.addEventListener("click", () => toast("Ê§úÁ¥¢„Éª„É¨„Ç¢„É™„ÉÜ„Ç£„ÉªÂ∫óÈ†≠/BOOTH„ÅßÁµû„ÇäËæº„Åø ‚Üí „Çø„ÉÉ„Éó„ÅßÊã°Â§ß"));

  // ÂàùÂõûË°®Á§∫
  render();

  // ÁîªÂÉè„É≠„Éº„ÉâÂ§±ÊïóÔºà‰∏ÄË¶ß„Å†„ÅëËñÑ„ÅèÔºâ
  grid.addEventListener("error", (e) => {
    const t = e.target;
    if (t && t.tagName === "IMG") t.style.opacity = "0.35";
  }, true);

})();
</script>
</body>
</html>
