<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>カードリスト｜第1弾（TN-001〜TN-050）</title>
<meta name="description" content="焼かれた伝説 たこ焼きトレーディングカード 第1弾カードリスト（公式一覧）。TN-001〜TN-025=店頭、TN-026〜TN-050=BOOTH。" />

<style>
:root{
  --bg:#0b0d17;
  --panel:rgba(255,255,255,.08);
  --panel2:rgba(255,255,255,.12);
  --line:rgba(255,255,255,.14);
  --text:#fff;
  --muted:rgba(255,255,255,.72);
  --shadow:0 18px 55px rgba(0,0,0,.55);
  --radius:18px;
  --radius2:14px;
  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
  --focus: rgba(160,220,255,.40);
  --glow: 0 10px 35px rgba(80,190,255,.14);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif;
  color:var(--text);
  background:
    radial-gradient(1200px 700px at 50% -10%, rgba(80,190,255,.18), transparent 60%),
    radial-gradient(900px 600px at 10% 20%, rgba(255,170,80,.10), transparent 60%),
    radial-gradient(900px 600px at 90% 40%, rgba(200,120,255,.08), transparent 60%),
    linear-gradient(180deg, #070815 0%, #0b0d17 55%, #070815 100%);
  overflow-x:hidden;
}
body:before{
  content:"";
  position:fixed; inset:0;
  pointer-events:none;
  opacity:.06;
  background-image:
    repeating-linear-gradient(0deg, rgba(255,255,255,.18), rgba(255,255,255,.18) 1px, transparent 1px, transparent 3px);
  mix-blend-mode: overlay;
}

/* ===== Header ===== */
header{
  position: sticky;
  top:0;
  z-index:10;
  padding: calc(14px + env(safe-area-inset-top)) 14px 12px;
  background: linear-gradient(180deg, rgba(7,8,21,.92), rgba(7,8,21,.70));
  border-bottom:1px solid rgba(255,255,255,.10);
  backdrop-filter: blur(10px);
}
.head-inner{
  max-width:1100px;
  margin:0 auto;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.left{
  display:flex;
  align-items:center;
  gap:10px;
  min-width:0;
}
.back{
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.08);
  color: var(--text);
  border-radius: 12px;
  padding: 10px 12px;
  font-weight: 900;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
}
.back:active{ transform: translateY(1px); }
.titlebox{
  min-width:0;
  display:flex;
  flex-direction:column;
  gap:2px;
}
.titlebox .title{
  font-size:16px;
  font-weight:1000;
  letter-spacing:.02em;
  line-height:1.2;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.titlebox .sub{
  font-size:12px;
  color:var(--muted);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.right{ display:flex; align-items:center; gap:10px; }
.btn{
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.12);
  color:#fff;
  border-radius:12px;
  padding:10px 12px;
  font-weight:900;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
}
.btn:active{ transform: translateY(1px); }

/* ===== Layout ===== */
main{
  max-width:1100px;
  margin:0 auto;
  padding: 14px 14px calc(18px + env(safe-area-inset-bottom));
  display:grid;
  gap:12px;
}
.panel{
  background: var(--panel);
  border:1px solid rgba(255,255,255,.14);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  overflow:hidden;
}
.top-panel{
  padding:12px;
  display:grid;
  gap:10px;
}
.meta-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
}
.pill{
  display:inline-flex;
  align-items:center;
  gap:8px;
  font-weight:1000;
  font-size:12px;
  padding:8px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.18);
}
.pill .dot{
  width:8px; height:8px; border-radius:999px;
  background: rgba(160,220,255,.95);
  box-shadow: 0 0 18px rgba(160,220,255,.65);
}
.stat{
  font-family: var(--mono);
  font-size:11px;
  color: rgba(255,255,255,.78);
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  padding: 6px 10px;
  border-radius: 999px;
  white-space:nowrap;
}

.controls{
  display:grid;
  grid-template-columns:1fr;
  gap:10px;
}
.search{
  display:flex;
  gap:8px;
  align-items:center;
  background: rgba(0,0,0,.18);
  border: 1px solid rgba(255,255,255,.10);
  border-radius: 14px;
  padding: 10px;
}
.search input{
  width:100%;
  border:none;
  outline:none;
  background:transparent;
  color:#fff;
  font-size:14px;
  font-weight:800;
}
.search input::placeholder{ color: rgba(255,255,255,.55); font-weight:800; }

.chipbar{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}
.chip{
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.08);
  color:#fff;
  border-radius:999px;
  padding:8px 10px;
  font-weight:1000;
  font-size:12px;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
  user-select:none;
}
.chip.active{
  border-color: rgba(160,220,255,.35);
  background: linear-gradient(180deg, rgba(160,220,255,.22), rgba(160,220,255,.12));
  box-shadow: var(--glow);
}
.chip:active{ transform: translateY(1px); }

.grid-panel{ padding:12px; }

/* ✅ 1列3枚（スマホでも3枚） */
.grid{
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap:10px;
}

/* 画面が狭すぎる端末だけ2枚に戻す（任意：超小型用） */
@media (max-width:360px){
  .grid{ grid-template-columns: repeat(2, 1fr); }
}

/* タブレット以上はそのまま増やしてOK */
@media (min-width:560px){ .grid{ grid-template-columns: repeat(4, 1fr); } }
@media (min-width:900px){ .grid{ grid-template-columns: repeat(5, 1fr); } }

.card{
  border:1px solid rgba(255,255,255,.14);
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
  border-radius:16px;
  overflow:hidden;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
  box-shadow: 0 14px 40px rgba(0,0,0,.28);
  display:grid;
  grid-template-rows:auto 1fr;
  min-height:200px;
  transition: transform .10s ease, border-color .10s ease;
  position:relative;
}
.card:hover{ border-color: rgba(160,220,255,.30); }
.card:active{ transform: scale(.995); }

.thumb{
  position:relative;
  width:100%;
  aspect-ratio: 3/4;
  background: rgba(0,0,0,.22);
  overflow:hidden;
}
.thumb img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

.ribbon{
  position:absolute;
  top:10px;
  left:10px;
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 8px;
  border-radius:999px;
  font-weight:1000;
  font-size:11px;
  color:#fff;
  background: rgba(0,0,0,.55);
  border:1px solid rgba(255,255,255,.16);
  backdrop-filter: blur(6px);
}
.ribbon .dot{
  width:8px; height:8px; border-radius:999px;
  background: rgba(160,220,255,.95);
  box-shadow: 0 0 18px rgba(160,220,255,.6);
}
.ribbon.shop .dot{ background: rgba(255,210,120,.95); box-shadow: 0 0 18px rgba(255,210,120,.55); }
.ribbon.booth .dot{ background: rgba(160,255,200,.95); box-shadow: 0 0 18px rgba(160,255,200,.55); }

.info{
  padding:10px 10px 12px;
  display:grid;
  gap:6px;
}
.no{
  font-family: var(--mono);
  font-size:11px;
  color: rgba(255,255,255,.78);
  letter-spacing:.02em;
}
.name{
  font-size:11.5px;
  font-weight:1000;
  line-height:1.28;
  letter-spacing:.01em;
}

.empty{
  padding:14px;
  color: var(--muted);
  font-weight:900;
  text-align:center;
  border: 1px dashed rgba(255,255,255,.22);
  border-radius: 16px;
  background: rgba(0,0,0,.12);
  display:none;
}

/* ===== Modal ===== */
.modal-bg{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  padding:16px;
  z-index:100;
  background: rgba(0,0,0,.62);
  backdrop-filter: blur(8px);
}
.modal-bg.open{ display:flex; }

.modal{
  width:min(560px, 100%);
  border-radius:18px;
  border: 1px solid rgba(255,255,255,.16);
  background:
    radial-gradient(900px 400px at 50% 0%, rgba(80,190,255,.14), transparent 62%),
    linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
  box-shadow: 0 22px 80px rgba(0,0,0,.65);
  overflow:hidden;
  transform: translateY(10px) scale(.985);
  opacity:0;
  transition: transform .14s ease, opacity .14s ease;
}
.modal-bg.open .modal{ transform: translateY(0) scale(1); opacity:1; }

.modal-head{
  padding:14px 14px 10px;
  border-bottom: 1px solid rgba(255,255,255,.12);
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:10px;
}
.modal-title{
  display:flex;
  flex-direction:column;
  gap:4px;
  min-width:0;
}
.modal-title .h{
  font-size:16px;
  font-weight:1000;
  letter-spacing:.02em;
  line-height:1.2;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.modal-title .p{
  font-size:12px;
  color: var(--muted);
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  align-items:center;
}
.tag{
  font-family: var(--mono);
  font-size:11px;
  color: rgba(255,255,255,.78);
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  padding: 4px 8px;
  border-radius: 999px;
  white-space: nowrap;
}
.xbtn{
  border:1px solid rgba(255,255,255,.16);
  background: rgba(0,0,0,.18);
  color:#fff;
  border-radius:12px;
  width:42px;
  height:42px;
  font-size:18px;
  font-weight:1000;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
}
.xbtn:active{ transform: translateY(1px); }

.modal-body{
  padding:14px;
  display:grid;
  gap:12px;
}
.bigimg{
  width:100%;
  aspect-ratio: 3/4;
  border-radius:16px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.20);
}
.bigimg img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}
.actions{
  display:grid;
  gap:10px;
}
.primary{
  border:1px solid rgba(160,220,255,.35);
  background: linear-gradient(180deg, rgba(160,220,255,.22), rgba(160,220,255,.12));
  box-shadow: var(--glow);
  border-radius:14px;
  padding:14px 12px;
  font-weight:1000;
  color:#fff;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
  text-align:center;
  text-decoration:none;
}
.ghost{
  border:1px solid rgba(255,255,255,.16);
  background: rgba(255,255,255,.08);
  border-radius:14px;
  padding:12px 10px;
  font-weight:1000;
  color:#fff;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
  text-align:center;
}
.primary:active,.ghost:active{ transform: translateY(1px); }

.toast{
  position: fixed;
  left: 12px;
  right: 12px;
  bottom: calc(14px + env(safe-area-inset-bottom));
  z-index: 200;
  pointer-events:none;
  opacity:0;
  transform: translateY(10px) scale(.98);
  transition: opacity .16s ease, transform .18s ease;
  padding: 12px 12px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.72);
  color: #fff;
  font-weight: 900;
  letter-spacing:.02em;
  text-align:center;
  box-shadow: 0 16px 60px rgba(0,0,0,.55);
}
.toast.show{ opacity:1; transform: translateY(0) scale(1); }

button:focus-visible, input:focus-visible{
  outline: 3px solid var(--focus);
  outline-offset: 2px;
}
</style>
</head>

<body>
<header>
  <div class="head-inner">
    <div class="left">
      <button id="backBtn" class="back" type="button" aria-label="戻る">←</button>
      <div class="titlebox">
        <div class="title">カードリスト：第1弾</div>
        <div class="sub">TN-001〜TN-025＝店頭 / TN-026〜TN-050＝BOOTH（公式一覧）</div>
      </div>
    </div>
    <div class="right">
      <button id="helpBtn" class="btn" type="button" aria-label="ヘルプ">？</button>
    </div>
  </div>
</header>

<main>
  <section class="panel top-panel">
    <div class="meta-row">
      <div class="pill"><span class="dot"></span> 第1弾（公式カードリスト）</div>
      <div id="statLine" class="stat">loading...</div>
    </div>

    <div class="controls">
      <div class="search">
        <input id="q" type="search" placeholder="検索：カード名 / TN-番号（例：TN-025）" autocomplete="off" />
      </div>

      <div class="chipbar" aria-label="フィルタ">
        <button class="chip active" data-rarity="ALL" type="button">全て</button>
        <button class="chip" data-rarity="N" type="button">N</button>
        <button class="chip" data-rarity="R" type="button">R</button>
        <button class="chip" data-rarity="SR" type="button">SR</button>
        <button class="chip" data-rarity="UR" type="button">UR</button>
        <button class="chip" data-rarity="LR" type="button">LR</button>

        <span style="width:10px;display:inline-block;"></span>

        <button class="chip active" data-place="ALL" type="button">店頭＋通販</button>
        <button class="chip" data-place="SHOP" type="button">店頭（001-025）</button>
        <button class="chip" data-place="BOOTH" type="button">BOOTH（026-050）</button>
      </div>
    </div>
  </section>

  <section class="panel grid-panel">
    <div id="grid" class="grid" aria-label="カード一覧"></div>
    <div id="empty" class="empty">該当カードが見つからない…（検索条件を変えてみて）</div>
  </section>
</main>

<!-- 詳細モーダル -->
<div id="modalBg" class="modal-bg" role="presentation" aria-hidden="true">
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="mTitle">
    <div class="modal-head">
      <div class="modal-title">
        <div id="mTitle" class="h">-</div>
        <div class="p">
          <span id="mNo" class="tag">-</span>
          <span id="mRarity" class="tag">-</span>
          <span id="mPlace" class="tag">-</span>
        </div>
      </div>
      <button id="mCloseX" class="xbtn" type="button" aria-label="閉じる">×</button>
    </div>

    <div class="modal-body">
      <div class="bigimg"><img id="mImg" alt="カード画像" /></div>
      <div class="actions">
        <a id="openImg" class="primary" href="#" target="_blank" rel="noopener">画像を別タブで開く</a>
        <button id="mClose" class="ghost" type="button">閉じる</button>
      </div>
    </div>
  </div>
</div>

<div id="toast" class="toast" aria-live="polite" aria-atomic="true"></div>

<script>
(() => {
  "use strict";

  // =========================
  // 設定
  // =========================
  const CONFIG = {
    // ここをあなたの導線に合わせて変えてOK
    BACK_URL: "./index.html", // 例：街マップに戻る
  };

  // =========================
  // ✅ cards-vol1.html 専用：非ホロ差し替え
  // （このページだけ画像を上書き。ゲーム内は無影響）
  // =========================
  const LIST_ONLY_NONHOLO = {
    "TN-025": "https://ul.h3z.jp/IDZNfaii.png",
    // まだ非ホロが無いUR/LRは「未登録」でOK（= 元のホロ画像のまま表示）
    // "TN-001": "https://...",
    // "TN-007": "https://...",
    // "TN-033": "https://...",
    // "TN-045": "https://...",
    // "TN-050": "https://...",
  };

  // =========================================================
  // カードプール（省略なし・全部）
  // =========================================================
  const CARD_POOLS = {
    N: [
      { no:"TN-005", name:"たこ焼きタワー112", img:"https://ul.h3z.jp/LoXMSiYd.jpg" },
      { no:"TN-006", name:"塩顔パレード焼き", img:"https://ul.h3z.jp/7L7rcrnM.jpg" },
      { no:"TN-009", name:"塩マヨ露天焼き", img:"https://ul.h3z.jp/bF9QmTE8.jpg" },
      { no:"TN-011", name:"チーズ火山焼き", img:"https://ul.h3z.jp/BEj3BIcP.jpg" },
      { no:"TN-012", name:"揚げ玉会議焼き", img:"https://ul.h3z.jp/vVw2FjQp.jpg" },
      { no:"TN-013", name:"くたびれ塩こしょう焼き", img:"https://ul.h3z.jp/DlX5pLJ5.jpg" },
      { no:"TN-016", name:"たこ焼き、発射オーライ", img:"https://ul.h3z.jp/50WYMkYw.jpg" },
      { no:"TN-018", name:"ゆのかわの主", img:"https://ul.h3z.jp/mkLBMxIT.jpg" },
      { no:"TN-019", name:"誤入店トラップ", img:"https://ul.h3z.jp/YfON5rBJ.jpg" },
      { no:"TN-021", name:"たこ焼き、流れて候", img:"https://ul.h3z.jp/O4s1VpWd.jpg" },
      { no:"TN-023", name:"芝生かたこ焼きか大会", img:"https://ul.h3z.jp/FZcOaXY8.jpg" },
      { no:"TN-024", name:"温泉女神のありがた迷惑", img:"https://ul.h3z.jp/A6WhBsqj.jpg" },
      { no:"TN-026", name:"たこ焼き48回リボ払い", img:"https://ul.h3z.jp/hz7JXyky.jpg" },
      { no:"TN-027", name:"全身たこ焼きダイエット", img:"https://ul.h3z.jp/FQ3poZLg.jpg" },
      { no:"TN-028", name:"自己啓発たこ塾", img:"https://ul.h3z.jp/sPChFFlG.jpg" },
      { no:"TN-029", name:"カロリーゼロ理論", img:"https://ul.h3z.jp/4HEbt3YP.jpg" },
      { no:"TN-031", name:"行列の最後尾が別県", img:"https://ul.h3z.jp/LBdFqlLI.jpg" },
      { no:"TN-034", name:"エシカル過剰焼き", img:"https://ul.h3z.jp/KRkSq4WD.jpg" },
      { no:"TN-036", name:"マヨネーズ詐欺", img:"https://ul.h3z.jp/NzVgPYdG.jpg" },
      { no:"TN-037", name:"勘違いデート", img:"https://ul.h3z.jp/riYYAnEi.jpg" },
      { no:"TN-041", name:"玉の上にも三年", img:"https://ul.h3z.jp/pQg0jZMy.jpg" },
      { no:"TN-043", name:"転生したら即売れたこ焼き", img:"https://ul.h3z.jp/I3JWnpoL.jpg" },
      { no:"TN-046", name:"ごますりたこ焼き", img:"https://ul.h3z.jp/tuLsTiaz.jpg" },
      { no:"TN-048", name:"店主反撃レビュー", img:"https://ul.h3z.jp/ge8b4cQ5.jpg" },
    ],
    R: [
      { no:"TN-002", name:"熱々地獄の給たこ所", img:"https://ul.h3z.jp/otr0dAQi.jpg" },
      { no:"TN-003", name:"爆走！たこ焼きライダー菜々", img:"https://ul.h3z.jp/06HrUPMT.jpg" },
      { no:"TN-008", name:"明太ギャラクシー焼き", img:"https://ul.h3z.jp/xye1uAfV.jpg" },
      { no:"TN-014", name:"世界たこ焼き釣り選手権大会", img:"https://ul.h3z.jp/cyekwiam.jpg" },
      { no:"TN-017", name:"たこ焼きマニフェスト", img:"https://ul.h3z.jp/zeSwFyjz.jpg" },
      { no:"TN-022", name:"たこ焼きダーツインフェルノ", img:"https://ul.h3z.jp/Prf7KxRk.jpg" },
      { no:"TN-032", name:"国境超えた恋", img:"https://ul.h3z.jp/9AZcVNmR.jpg" },
      { no:"TN-035", name:"デリバリー長距離便", img:"https://ul.h3z.jp/z0xhODVy.jpg" },
      { no:"TN-038", name:"恋落ちマッチング", img:"https://ul.h3z.jp/BPEoWjuY.jpg" },
      { no:"TN-042", name:"たこ焼きループザループ", img:"https://ul.h3z.jp/vxKamb6f.jpg" },
      { no:"TN-044", name:"白い契約", img:"https://ul.h3z.jp/bC1B4WkQ.jpg" },
      { no:"TN-047", name:"ボスゲート", img:"https://ul.h3z.jp/GHWrtaYk.jpg" },
    ],
    SR: [
      { no:"TN-004", name:"見えるフリ焼き", img:"https://ul.h3z.jp/irs6Sxoy.jpg" },
      { no:"TN-010", name:"焼ク者ノ証", img:"https://ul.h3z.jp/6A2LOn4A.jpg" },
      { no:"TN-015", name:"顔コイン", img:"https://ul.h3z.jp/7GUyGDU1.jpg" },
      { no:"TN-020", name:"ピック不要の真実", img:"https://ul.h3z.jp/Bu1pk4ul.jpg" },
      { no:"TN-030", name:"ガチャたこ焼き", img:"https://ul.h3z.jp/kFpjcqSv.jpg" },
      { no:"TN-039", name:"ドローン誤配達", img:"https://ul.h3z.jp/70A10oHf.jpg" },
      { no:"TN-040", name:"推し活たこ団扇", img:"https://ul.h3z.jp/jY5MVsrt.jpg" },
      { no:"TN-049", name:"たこ焼きの御神体", img:"https://ul.h3z.jp/GQ8H0lGq.jpg" },
    ],
    UR: [
      { no:"TN-001", name:"黒き真珠イカさま焼き", img:"https://ul.h3z.jp/2KeO7gmu.jpg" },
      { no:"TN-007", name:"ローソク出せ！", img:"https://ul.h3z.jp/FI5xXdQ7.jpg" },
      { no:"TN-033", name:"鉄板のビーナス", img:"https://ul.h3z.jp/0Tvf0Asc.jpg" },
      { no:"TN-045", name:"ドリームファイト", img:"https://ul.h3z.jp/IzPy6UsO.jpg" },
    ],
    LR: [
      { no:"TN-025", name:"たこ焼き化石in函館山", img:"https://ul.h3z.jp/BR1X7scb.png" },
      { no:"TN-050", name:"焼かれし記憶、ソースに還る", img:"https://ul.h3z.jp/0I6s0icl.jpg" },
    ],
  };

  // =========================
  // DOM
  // =========================
  const $ = (q) => document.querySelector(q);
  const $$ = (q) => Array.from(document.querySelectorAll(q));

  const backBtn = $("#backBtn");
  const helpBtn = $("#helpBtn");
  const statLine = $("#statLine");
  const qInput = $("#q");
  const grid = $("#grid");
  const empty = $("#empty");

  const modalBg = $("#modalBg");
  const mCloseX = $("#mCloseX");
  const mClose = $("#mClose");
  const mTitle = $("#mTitle");
  const mNo = $("#mNo");
  const mRarity = $("#mRarity");
  const mPlace = $("#mPlace");
  const mImg = $("#mImg");
  const openImg = $("#openImg");

  const toastEl = $("#toast");

  // =========================
  // toast
  // =========================
  let toastTimer = null;
  function toast(msg){
    clearTimeout(toastTimer);
    toastEl.textContent = msg;
    toastEl.classList.add("show");
    toastTimer = setTimeout(() => toastEl.classList.remove("show"), 1400);
  }

  // =========================
  // Utils
  // =========================
  const RARITY_ORDER = ["N","R","SR","UR","LR"];

  function parseNum(no){
    const m = String(no).match(/(\d{1,4})/);
    return m ? parseInt(m[1], 10) : NaN;
  }
  function placeOf(no){
    const n = parseNum(no);
    if (!Number.isFinite(n)) return "UNKNOWN";
    if (n >= 1 && n <= 25) return "SHOP";
    if (n >= 26 && n <= 50) return "BOOTH";
    return "UNKNOWN";
  }
  function placeLabel(place){
    if(place==="SHOP") return "店頭";
    if(place==="BOOTH") return "BOOTH";
    return "不明";
  }
  function normalize(s){
    return String(s || "")
      .toLowerCase()
      .replace(/\s+/g,"")
      .replace(/　+/g,"");
  }
  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, (m) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }

  // ✅ このページだけ「表示用画像」を返す
  function imgForList(card){
    return LIST_ONLY_NONHOLO[card.no] || card.img;
  }

  // =========================
  // Flatten
  // =========================
  function buildFlat(){
    const out = [];
    for (const r of RARITY_ORDER){
      const arr = CARD_POOLS[r] || [];
      for (const c of arr){
        out.push({
          rarity: r,
          no: c.no,
          name: c.name,
          img: c.img,
          num: parseNum(c.no),
          place: placeOf(c.no),
        });
      }
    }
    out.sort((a,b) => (a.num - b.num) || (RARITY_ORDER.indexOf(a.rarity) - RARITY_ORDER.indexOf(b.rarity)));
    return out;
  }
  const ALL = buildFlat();

  // =========================
  // State
  // =========================
  const state = {
    rarity: "ALL",
    place: "ALL",
    q: "",
  };

  // =========================
  // Chips
  // =========================
  const rarityChips = $$(".chip[data-rarity]");
  const placeChips  = $$(".chip[data-place]");

  function setActiveChip(list, predicate){
    for (const el of list){
      el.classList.toggle("active", predicate(el));
    }
  }

  rarityChips.forEach(el => {
    el.addEventListener("click", () => {
      state.rarity = el.dataset.rarity;
      setActiveChip(rarityChips, x => x.dataset.rarity === state.rarity);
      render();
    });
  });

  placeChips.forEach(el => {
    el.addEventListener("click", () => {
      state.place = el.dataset.place;
      setActiveChip(placeChips, x => x.dataset.place === state.place);
      render();
    });
  });

  qInput.addEventListener("input", () => {
    state.q = qInput.value || "";
    render();
  });

  // =========================
  // Modal
  // =========================
  let lastFocus = null;

  function openModal(card){
    lastFocus = document.activeElement;

    mTitle.textContent = card.name;
    mNo.textContent = card.no;
    mRarity.textContent = `RARITY:${card.rarity}`;
    mPlace.textContent = placeLabel(card.place);

    // ✅ モーダルも「このページ用の画像」で開く
    const src = imgForList(card);
    mImg.src = src;
    mImg.alt = `${card.name}（${card.no}）`;
    openImg.href = src;

    modalBg.classList.add("open");
    modalBg.setAttribute("aria-hidden","false");
    setTimeout(() => mCloseX.focus({preventScroll:true}), 10);
  }

  function closeModal(){
    modalBg.classList.remove("open");
    modalBg.setAttribute("aria-hidden","true");
    if (lastFocus && typeof lastFocus.focus === "function"){
      setTimeout(() => lastFocus.focus({preventScroll:true}), 10);
    }
  }

  modalBg.addEventListener("click", (e) => {
    if (e.target === modalBg) closeModal();
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && modalBg.classList.contains("open")){
      e.preventDefault();
      closeModal();
    }
  });

  mCloseX.addEventListener("click", closeModal);
  mClose.addEventListener("click", closeModal);

  // =========================
  // Render
  // =========================
  function filtered(){
    const nq = normalize(state.q);

    return ALL.filter(c => {
      if (state.rarity !== "ALL" && c.rarity !== state.rarity) return false;
      if (state.place !== "ALL" && c.place !== state.place) return false;

      if (nq){
        const hay = normalize(`${c.no} ${c.name} ${c.rarity} ${placeLabel(c.place)}`);
        if (!hay.includes(nq)) return false;
      }
      return true;
    });
  }

  function render(){
    const list = filtered();
    const total = ALL.length;
    const shown = list.length;

    statLine.textContent = `表示:${shown}/${total}（公式）`;

    grid.innerHTML = "";
    empty.style.display = (shown === 0) ? "block" : "none";

    for (const c of list){
      const place = c.place;
      const ribbonClass = place === "SHOP" ? "ribbon shop" : (place === "BOOTH" ? "ribbon booth" : "ribbon");
      const ribbonText  = place === "SHOP" ? "店頭" : (place === "BOOTH" ? "BOOTH" : "不明");

      const card = document.createElement("div");
      card.className = "card";
      card.setAttribute("role","button");
      card.setAttribute("tabindex","0");
      card.setAttribute("aria-label", `${c.no} ${c.name} を開く`);

      // ✅ 一覧も「このページ用の画像」で表示
      const src = imgForList(c);

      card.innerHTML = `
        <div class="thumb">
          <img loading="lazy" decoding="async" src="${src}" alt="${escapeHtml(c.name)}">
          <div class="${ribbonClass}"><span class="dot"></span>${ribbonText}</div>
        </div>
        <div class="info">
          <div class="no">${c.no} / ${c.rarity}</div>
          <div class="name">${escapeHtml(c.name)}</div>
        </div>
      `;

      const open = () => openModal(c);
      card.addEventListener("click", open);
      card.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " "){
          e.preventDefault();
          open();
        }
      });

      grid.appendChild(card);
    }
  }

  // =========================
  // Header buttons
  // =========================
  backBtn.addEventListener("click", () => location.href = CONFIG.BACK_URL);
  helpBtn.addEventListener("click", () => toast("検索・レアリティ・店頭/BOOTHで絞り込み → タップで拡大"));

  // 初回表示
  render();

  // 画像ロード失敗（一覧だけ薄く）
  grid.addEventListener("error", (e) => {
    const t = e.target;
    if (t && t.tagName === "IMG") t.style.opacity = "0.35";
  }, true);

})();
</script>
</body>
</html>
