<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>マイ露店</title>

  <!-- ✅ 分離したCSS -->
  <link rel="stylesheet" href="assets/myshop.css">
</head>

<body>
  <!-- ===== Header（屋台っぽく：タイトル＋小さなサブ） ===== -->
  <div class="header">
    <div class="head-inner">
      <button class="back" id="backBtn" type="button" aria-label="戻る">←</button>

      <div class="titlebox">
        <div class="title">マイ露店</div>
        <div style="font-size:12px;color:var(--muted);margin-top:2px;letter-spacing:.02em">
          夜祭り屋台モード / 売買は「来店ステージ」で発生
        </div>
      </div>

      <div class="top-actions">
        <button class="btn ghost" id="helpBtn" type="button" aria-label="ヘルプ">？</button>
      </div>
    </div>
  </div>

  <div class="wrap">

    <!-- ===== ステージを最上段に（主役） ===== -->
    <div class="card stage-card">
      <div class="card-h">
        <div>
          <div class="card-title">来店ステージ</div>
          <div class="card-desc">背景（昼/夜）に、客タコ民（透過）を重ねて表示。誰もいない時は背景だけ。</div>
        </div>
        <button class="btn ghost" id="fixBtn" type="button">修理</button>
      </div>

      <div class="card-b">
        <div class="stage" id="stage" aria-label="来店ステージ">
          <img id="stageBg" class="stage-bg" alt="" src="">
          <img id="stageVisitor" class="stage-visitor" alt="" src="">

          <div class="stage-ui">
            <div class="bubble">
              <div class="n" id="stageName">—</div>
              <div class="m" id="stageMsg">まだ誰も来ていない。</div>
            </div>

            <div class="stage-tags" aria-label="ステージ情報">
              <div class="tag" id="stageTimeTag">—</div>
              <div class="tag" id="stageNextTag">次：—</div>
            </div>
          </div>
        </div>

        <!-- ちょい演出：ステージ下に一言（雰囲気だけ） -->
        <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
          <div class="pill">🏮 <b style="font-weight:900">屋台モード</b></div>
          <div class="pill">🎴 棚に置くだけでOK</div>
          <div class="pill">✨ 売れたらチャリーン</div>
        </div>
      </div>
    </div>

    <!-- ===== ステータスを“札”として見せる ===== -->
    <div class="card" style="margin-bottom:12px">
      <div class="card-h">
        <div>
          <div class="card-title">ステータス</div>
          <div class="card-desc">オクト / レベル / 評判 / 出品状況</div>
        </div>
        <div class="pill mono" aria-label="ヒント">TIP: 評判が高いほど客層が良くなる</div>
      </div>
      <div class="card-b">
        <div class="stats" id="stats"></div>
      </div>
    </div>

    <!-- ===== 棚（出品）を先に、ログは後ろ ===== -->
    <div class="grid">

      <div class="card">
        <div class="card-h">
          <div>
            <div class="card-title">棚（出品）</div>
            <div class="card-desc">棚にカードを置くだけ。売買は来店ステージで発生。</div>
          </div>

          <div class="head-actions-row">
            <button class="btn warn" id="shoutBtn" type="button">呼び込み</button>
            <div class="cd mono" id="shoutCd">—</div>
          </div>
        </div>

        <div class="card-b">
          <!-- 説明を少し“ゲーム”っぽく -->
          <div style="font-size:12px;color:var(--muted);line-height:1.55;margin-bottom:10px">
            棚をタップして <b style="color:var(--text)">カードをセット</b> →
            客が来たら <b style="color:var(--text)">自動で売買</b> →
            売れたら <b style="color:var(--text)">EXP & オクト</b> が増える
          </div>

          <div class="shelves" id="shelves"></div>
        </div>
      </div>

      <div class="card">
        <div class="card-h">
          <div>
            <div class="card-title">最近の出来事</div>
            <div class="card-desc">ログ</div>
          </div>
          <div class="pill">🧾 売買・来客の記録</div>
        </div>
        <div class="card-b">
          <div class="log" id="log"></div>
        </div>
      </div>

    </div>
  </div>

  <!-- ★右下固定：バックアップ/復元 -->
  <div class="fab-wrap" aria-label="バックアップと復元">
    <button class="btn ghost" id="backupBtn" type="button">バックアップ</button>
    <button class="btn ghost" id="restoreBtn" type="button">復元</button>
  </div>

  <!-- ===== 出品ピッカー ===== -->
  <div class="modal" id="pickModal" aria-hidden="true">
    <div class="sheet" role="dialog" aria-label="出品するカードを選ぶ">
      <div class="sheet-h">
        <div>
          <b id="pickTitle">出品するカード</b>
          <div style="margin-top:4px;font-size:12px;color:var(--muted)" id="pickHint">棚を選んでからカードを選択。</div>
        </div>
        <button class="btn close" id="pickClose" type="button" aria-label="閉じる">×</button>
      </div>

      <div class="sheet-b">
        <div class="cards" id="pickCards"></div>
        <div style="margin-top:10px;font-size:12px;color:var(--muted);display:none" id="pickEmpty">
          ダブりカード（図鑑に1枚残しても余る分）がありません。
        </div>
      </div>

      <div class="sheet-actions">
        <button class="btn" id="pickCancel" type="button">キャンセル</button>
      </div>
    </div>
  </div>

  <!-- ===== Help ===== -->
  <div class="modal" id="helpModal" aria-hidden="true">
    <div class="sheet" role="dialog" aria-label="ヘルプ">
      <div class="sheet-h">
        <b>露店の遊び方</b>
        <button class="btn close" id="helpClose" type="button" aria-label="閉じる">×</button>
      </div>

      <div class="sheet-b">
        <div style="font-size:12px;color:rgba(255,255,255,.86);line-height:1.65">
          ・棚をタップ → 「図鑑に1枚残しても余る分」から出品<br>
          ・売買は「来店ステージ」でのみ発生<br>
          ・来客だけでも EXP +1（育つ）<br>
          ・売れたら EXP 追加 +4（合計+5）<br>
          ・王様が買うと評判UP / 転売が買うと評判DOWN<br>
          ・「呼び込み」は60秒に1回、<b>通常スケジュール（次：xxx）は変えずに</b>、呼び込んだ客だけ先に来る<br>
          ・もし通常の来客タイミングと被ったら、通常の方は<b>待機</b>して、呼び込み客が帰ったら来る<br><br>
          <b>棚解放</b><br>
          Lv1: 棚1-2 / Lv2: 棚3 / Lv3: 棚4 / Lv4: 棚5
        </div>
      </div>

      <div class="sheet-actions">
        <button class="btn" id="helpOk" type="button">OK</button>
      </div>
    </div>
  </div>

  <!-- ===== Effects / Toast ===== -->
  <div class="sale-flash" id="saleFlash" aria-hidden="true"></div>

  <div class="toast" aria-live="polite" aria-atomic="true">
    <div class="box" id="toastBox">
      <b id="toastTitle">—</b>
      <div class="small" id="toastSub">—</div>
    </div>
  </div>

  <input id="restoreFile" type="file" accept="application/json" style="display:none" />

  <!-- ✅ 分離したJS（deferでDOM後に実行） -->
  <script defer src="assets/myshop.js"></script>
</body>
</html>

