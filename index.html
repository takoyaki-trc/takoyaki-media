<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- =========================
       基本メタ（先に置く）
  ========================== -->
  <meta charset="utf-8">
  <meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <!-- タイトル -->
  <title>焼かれた伝説｜たこ焼きトレーディングカード</title>
  <meta name="description" content="ゲームみたいに遊べる、たこ焼きトレカの世界。街マップ・畑・露店・図鑑・イベント・最新情報。">

  <!-- ✅ 正式URL（ルート /takoyaki-media/ に変更） -->
  <link rel="canonical" href="https://takoyaki-trc.github.io/takoyaki-media/">

  <!-- =========================
       OGP（共有用）
  ========================== -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="焼かれた伝説｜たこ焼きトレカ">
  <meta property="og:locale" content="ja_JP">
  <meta property="og:title" content="焼かれた伝説｜たこ焼きトレーディングカード">
  <meta property="og:description" content="ゲームみたいに遊べる、たこ焼きトレカの世界。街マップ・畑・露店・図鑑・イベント・最新情報。">
  <meta property="og:url" content="https://takoyaki-trc.github.io/takoyaki-media/">
  <meta property="og:image" content="https://ul.h3z.jp/0yeAj4R7.png">

  <!-- =========================
       Twitterカード
  ========================== -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="焼かれた伝説｜たこ焼きトレーディングカード">
  <meta name="twitter:description" content="街マップ・畑・露店・図鑑・イベント。ゲームみたいに遊べる“たこ焼きトレカ”の世界へ。">
  <meta name="twitter:image" content="https://ul.h3z.jp/0yeAj4R7.png">

  <!-- =========================
       アイコン（絶対パス版：そのままでOK）
  ========================== -->
  <link rel="icon" href="https://takoyaki-trc.github.io/takoyaki-media/town/assets/images/icon.png">
  <link rel="apple-touch-icon" href="https://takoyaki-trc.github.io/takoyaki-media/town/assets/images/icon.png">
  <meta name="apple-mobile-web-app-title" content="焼かれた伝説">

  <!-- =========================
       CSP（http画像の混在を自動でhttpsに）
  ========================== -->
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

  <!-- =========================
       アクセス解析（GA4）
  ========================== -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-D3RHSWHL9J"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-D3RHSWHL9J');
  </script>

  <!-- =========================
       ここからCSS（あなたの既存をそのまま）
  ========================== -->
  <style>
    /* 空レイヤー：BASEの背景に負けない */
    body::before{
      content:"";
      position: fixed;
      inset: 0;
      z-index: -1;
      pointer-events: none;

      /* 3層＋ビネット */
      background:
        radial-gradient(
          ellipse at center,
          rgba(0,0,0,0) 55%,
          rgba(0,0,0,0.18) 100%
        ),
        var(--sky, linear-gradient(
          #87b8e5 0%,
          #cfe8ff 55%,
          #ffffff 100%
        ));

      transition: background 6s linear;
    }

    /* ===== 太陽 / 月 レイヤー ===== */
    .phase-dot.is-active{
      opacity: 1;
      transform: scale(1.0);
      filter: drop-shadow(0 0 6px rgba(255,255,255,0.35));
    }
    .phase-dot.sun{
      background: radial-gradient(circle at 30% 30%, #fff7c8 0%, #ffd86b 55%, #f2b705 100%);
      box-shadow: 0 0 14px rgba(255,200,80,0.35);
    }
    .phase-dot.moon{
      background: radial-gradient(circle at 35% 30%, #ffffff 0%, #e6e6e6 70%, #cfcfcf 100%);
    }
    .phase-dot.moon::after{
      content:"";
      position:absolute;
      inset:0;
      border-radius:50%;
      background: rgba(15,20,32,0.95);
      transform: translateX(var(--shadow-x, 0px));
    }
    @media (max-width:480px){
      #phase-strip .phase-dot{ width:36px; height:36px; }
    }

    /* ===== 太陽／月が動くレール ===== */
    #phase-strip{
      position: relative;
      width: 220px;
      height: 54px !important;
      margin: 0 auto 4px !important;
      padding: 0 !important;
    }

    /* ===== 動く本体（共通） ===== */
    #phase-orb{
      position: absolute;
      top: 0 !important;
      left: 0;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      image-rendering: pixelated;
      transition:
        transform 0.6s ease,
        filter 0.6s ease,
        background 0.6s ease;
    }

    /* ===== 太陽（昼） ===== */
    #phase-orb.sun{
      background: radial-gradient(
        circle at 30% 30%,
        #fff7c8 0%,
        #ffd86b 55%,
        #f2b705 100%
      );
      box-shadow: 0 0 14px rgba(255,200,80,0.35);
      transform: scale(1);
    }

    /* ===== 月（夜） ===== */
    #phase-orb.moon{
      background: radial-gradient(
        circle at 35% 30%,
        #ffffff 0%,
        #e6e6e6 70%,
        #cfcfcf 100%
      );
      transform: scale(0.8);
    }

    /* ===== 月の満ち欠け（影） ===== */
    #phase-orb.moon::after{
      content:"";
      position:absolute;
      inset:0;
      border-radius:50%;
      background: rgba(15,20,32,0.95);
      transform: translateX(var(--shadow-x, 0px));
    }

    /* ===== スマホ微調整 ===== */
    @media (max-width:480px){
      #phase-strip{ width: 200px; }
      #phase-orb{ width: 36px; height: 36px; }
    }

    /* ================================
       MAP 基準（iPhoneズレ対策 完全版）
    ================================ */

    html, body{
      margin: 0;
      padding: 0;
      width: 100%;
    }

    body{
      overflow-x: hidden;
    }

    .title-gif{
      width: min(720px, 90%);
      margin: 0 auto 24px;
      display: block;
    }

    .map-wrap{
      position: relative !important;
      display: block;
      width: 100% !important;
      max-width: 800px;
      margin: 0 auto !important;
      padding: 0 !important;
      border: 0 !important;
      box-sizing: border-box !important;
      transform: translateZ(0);
      -webkit-transform: translateZ(0);
    }

    .map-wrap .map-img{
      position: relative;
      display: block !important;
      width: 100% !important;
      max-width: 100% !important;
      height: auto !important;
      margin: 0 !important;
      padding: 0 !important;
      border: 0 !important;
      box-sizing: border-box !important;
      image-rendering: pixelated;
      transform: translateZ(0);
      -webkit-transform: translateZ(0);
    }

    .map-wrap .hotspot,
    .map-wrap .tf-building{
      position: absolute !important;
      display: block !important;
      z-index: 60 !important;
      cursor: pointer;
      transform: translateZ(0);
      -webkit-transform: translateZ(0);
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    .map-wrap .tf-building > img{
      display: block;
      width: 100%;
      height: auto;
    }

    @media (hover:hover){
      .map-wrap .hotspot:hover,
      .map-wrap .tf-building:hover{
        outline: 2px solid rgba(255,255,200,0.9);
        box-shadow: 0 0 12px rgba(255,255,200,0.9);
      }
    }

    body.shop #mainFooter.wrapper{ margin-bottom: 0 !important; }
    body.shop #mainFooter{ margin: 20px auto 0 !important; padding: 0 !important; }
    body.shop #mainFooter .footerMenu ul li{ margin-bottom: 0 !important; }
    body.shop #mainFooter.wrapper,
    body.shop #mainFooter.wrapper + #base_url{
      margin: 0 !important;
      padding: 0 !important;
    }

    .map-wrap .tf-building{ position: absolute !important; display: block !important; z-index: 60 !important; }
    .map-wrap .map-img{ position: relative; z-index: 0; }
    .map-wrap .hotspot{ z-index: 10 !important; }
    .map-wrap .spot{ z-index: 20 !important; }
    .map-wrap .gate-hit{ z-index: 30 !important; }
    .map-wrap .tf-building{ z-index: 40 !important; }
    .map-wrap .takomin{ z-index: 60 !important; }
    .map-wrap .takomin-balloon{ z-index: 80 !important; }
  </style>

  <!-- ✅ ルート配下(index.html)になったので ./town/ に付け替え -->
  <link rel="stylesheet" href="./town/assets/css/boss-local.css?v=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/takoyaki-trc/takoyaki-gate@main/takomin-npc2.css?v=789">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/takoyaki-trc/takoyaki-gate@main/hotspot1.css?v=777">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/takoyaki-trc/takoyaki-media@main/town/assets/saidan.css?v=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/takoyaki-trc/takoyaki-gate@main/takomin-murabito.css?v=777">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/takoyaki-trc/takoyaki-media@main/town/assets/takofarm1.css?v=2">

  <style>
    /* ===== フッター内 バックアップボックス ===== */
    #trcFooterDataBox{
      width: min(720px, 92%);
      margin: 14px auto 10px;
      padding: 12px 12px;
      border: 2px solid rgba(255,255,255,.22);
      border-radius: 14px;
      background: rgba(10,10,18,.55);
      backdrop-filter: blur(6px);
      box-shadow: 0 16px 50px rgba(0,0,0,.45);
      text-align: left;
    }
    #trcFooterDataBox .row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    #trcFooterDataBox .title{
      display:flex;
      align-items:center;
      gap:8px;
      font-weight: 900;
      letter-spacing:.03em;
      color:#fff;
    }
    #trcFooterDataBox .dot{
      width:8px; height:8px;
      border-radius:999px;
      background: rgba(180,220,255,.85);
      box-shadow: 0 0 0 2px rgba(180,220,255,.18);
    }
    #trcFooterDataBox .desc{
      margin-top: 8px;
      font-size: 12px;
      line-height: 1.6;
      color: rgba(255,255,255,.76);
    }
    #trcFooterDataBox .btns{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    #trcFooterDataBox .btn{
      border: 2px solid rgba(255,255,255,.30);
      background: rgba(255,255,255,.08);
      color:#fff;
      border-radius: 12px;
      padding: 10px 12px;
      font-weight: 900;
      letter-spacing: .03em;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      white-space: nowrap;
    }
    #trcFooterDataBox .btn.primary{
      background: linear-gradient(180deg, rgba(140,200,255,.22), rgba(255,255,255,.08));
      border-color: rgba(180,220,255,.55);
    }
    #trcFooterDataBox .btn:active{ transform: translateY(1px); }
    @media (max-width:420px){
      #trcFooterDataBox{ padding: 10px 10px; }
      #trcFooterDataBox .btn{ padding: 9px 10px; font-size: 12px; }
    }
  </style>
</head>

<body class="shop template">

<div id="phase-strip">
  <div id="phase-orb"></div>
</div>

<div class="page-center">
  <!-- ▼ タイトル画像 -->
  <center>
    <img src="https://ul.h3z.jp/h12u4pD5.gif" style="display:block;width:400px !important;height:auto !important;">
    <img src="https://basefile.akamaized.net/takoyakitrc-base-shop/69613a78bcb90/mojiji.png">
  </center>

  <!-- ==========================================
    タイトル下・タコ民表示（アクセスごとにランダム）
  ========================================== -->
  <div id="takominArea" class="takomin-area">
    <div class="takomin-wrap">
      <a id="takominLink" class="takomin-avatar" href="#" target="_blank" rel="noopener">
        <img id="takominImg" src="" alt="タコ民">
      </a>
      <div class="takomin-text">
        <span id="takominLine">……</span>
      </div>
    </div>
  </div>
</div>

<!-- ✅ トースト（宝箱など：トップで1個だけ） -->
<div class="tf-toast" aria-live="polite"></div>

<!-- ✅ 街マップのラッパー（宝箱はこの中に出る） -->
<div class="map-wrap" id="townMap" style="position:relative;">

  <!-- ✅ 建物リンク：./town/ に変更 -->
  <a class="tf-building" href="./town/farm.html" aria-label="たこ焼き畑へ" style="left:19.5%; top:99%; width:110px;">
    <img src="https://ul.h3z.jp/iF0mVDkG.png" alt="たこ焼き畑（建物）">
  </a>

  <a class="tf-building" href="./town/roten.html" aria-label="露店へ" style="left:20%; top:93%; width:140px;">
    <img src="https://ul.h3z.jp/AFW27Fek.png" alt="露店（建物）">
  </a>

  <a class="tf-building" href="./town/zukan.html" aria-label="カード図鑑へ" style="left:80%; top:96%; width:50px;">
    <img src="https://ul.h3z.jp/nJLgRZOL.png" alt="カード図鑑（建物）">
  </a>

  <!-- 宝箱は takofarm2/3.js がここに自動出没させる -->

  <!-- ここからたこ焼きの祭壇（収益用） -->
  <button class="spot spot--gate" type="button" aria-label="たこ焼きゲート（見た目）">
    <img class="spot__base"
         src="https://ul.h3z.jp/DOpnGGIS.png"
         data-day="https://ul.h3z.jp/DOpnGGIS.png"
         data-night="https://ul.h3z.jp/RrfereXw.png"
         alt="たこ焼きの祭壇">
    <img class="spot__icon" src="https://ul.h3z.jp/G9HOojAP.png" alt="行き先アイコン">
  </button>

  <button class="gate-hit" type="button" aria-label="たこ焼きゲート（タップ判定）"></button>

  <div id="gateModal" class="gate-modal" aria-hidden="true">
    <div class="gate-modal__panel" role="dialog" aria-modal="true" aria-labelledby="gateModalTitle">
      <img id="gateModalPhoto" class="gate-modal__photo" src="" alt="">
      <div class="gate-modal__body">
        <div id="gateModalTitle" class="gate-modal__title">たこ焼きゲート</div>
        <div id="gateModalDesc" class="gate-modal__desc"></div>
        <div class="gate-modal__btns">
          <button id="gateModalCancel" type="button" class="gate-modal__btn">やめる</button>
          <a id="gateModalGo" class="gate-modal__btn gate-modal__btn--go" href="#" target="_blank" rel="noopener">行く</a>
        </div>
      </div>
    </div>
  </div>

  <img class="map-img"
    src="https://ul.h3z.jp/0yeAj4R7.png"
    alt="背景"
    data-morning="https://ul.h3z.jp/D4jEiu5y.png"
    data-day="https://ul.h3z.jp/bHkJV3PU.png"
    data-night="https://ul.h3z.jp/EOmNLbDO.png"/>

  <!-- ✅ ボスゲート（夜だけ表示＆タップでボス会話→バトル） -->
  <a class="boss-gate night-only" href="#" aria-label="鉄板魔グマに挑む">
    <img src="https://ul.h3z.jp/CsjyEnG3.png" alt="ボスゲート">
  </a>

  <!-- ▼タコ民群（中身そのまま） -->
  <button class="takomin takomin--ghost takomin--glow is-float" data-id="ghost" type="button" aria-label="GHOSTのタコ民">
    <img src="https://ul.h3z.jp/yfWcFrT4.png" data-day="https://ul.h3z.jp/yfWcFrT4.png" data-night="https://ul.h3z.jp/93R4C9fH.png" alt="GHOST">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--yousha takomin--glow" data-id="yousha" type="button" aria-label="YOUSHA">
    <img src="https://ul.h3z.jp/XNnElwbh.png" data-day="https://ul.h3z.jp/XNnElwbh.png" data-night="https://ul.h3z.jp/2LR6QUQf.png" alt="YOUSHA">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--motoyu is-step takomin--glow" data-id="motoyu" type="button" aria-label="たこ焼き菜々（もとの湯）のタコ民">
    <img src="https://ul.h3z.jp/vsy0pctI.png" data-day="https://ul.h3z.jp/vsy0pctI.png" data-night="https://ul.h3z.jp/PpSfLird.png" alt="もとの湯">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--kbc takomin--glow" data-id="kbc" type="button" aria-label="久留米ＫＢＣ">
    <img src="https://ul.h3z.jp/fy5i61XI.png" data-day="https://ul.h3z.jp/fy5i61XI.png" data-night="https://ul.h3z.jp/mGbOq0Q5.png" alt="久留米ＫＢＣ">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--katana takomin--glow" data-id="katana" type="button" aria-label="刀鍛冶">
    <img src="https://ul.h3z.jp/OnsDTpd8.png" data-day="https://ul.h3z.jp/OnsDTpd8.png" data-night="https://ul.h3z.jp/KgDhxsxP.png" alt="刀鍛冶">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--hotel takomin--glow" data-id="hotel" type="button" aria-label="旅路の塔">
    <img src="https://ul.h3z.jp/hx0gOm4a.png" data-day="https://ul.h3z.jp/hx0gOm4a.png" data-night="https://ul.h3z.jp/hx0gOm4a.png" alt="旅路の塔">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--bigmans takomin--glow" data-id="bigmans" type="button" aria-label="BIGMANS">
    <img src="https://ul.h3z.jp/sticAk2s.png" data-day="https://ul.h3z.jp/sticAk2s.png" data-night="https://ul.h3z.jp/q8H3THcE.png" alt="BIGMANS">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--twobit takomin--glow" data-id="twobit" type="button" aria-label="twobit">
    <img src="https://basefile.akamaized.net/takoyakitrc-base-shop/696a673f108bf/2bit1.png"
      data-day="https://basefile.akamaized.net/takoyakitrc-base-shop/696a673f108bf/2bit1.png"
      data-night="https://basefile.akamaized.net/takoyakitrc-base-shop/696a6755c2e31/2bit2.png"
      alt="twobit">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--hanaya takomin--glow" data-id="hanaya" type="button" aria-label="華矢式">
    <img src="https://ul.h3z.jp/JPKQZ6sP.png" data-day="https://ul.h3z.jp/JPKQZ6sP.png" data-night="https://ul.h3z.jp/yF9zSCHU.png" alt="華矢式">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--mars takomin--glow" data-id="mars" type="button" aria-label="mars">
    <img src="https://ul.h3z.jp/n6sTv8Xr.png" data-day="https://ul.h3z.jp/n6sTv8Xr.png" data-night="https://ul.h3z.jp/tHlNh1NI.png" alt="mars">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--dollis takomin--glow" data-id="dollis" type="button" aria-label="ドリズ">
    <img src="https://ul.h3z.jp/yi2Zbd3I.png" data-day="https://ul.h3z.jp/yi2Zbd3I.png" data-night="https://ul.h3z.jp/FmYMG8fu.png" alt="ドリズ">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--puni takomin--glow" data-id="puni" type="button" aria-label="ぷにぷに">
    <img src="https://ul.h3z.jp/ujUBACrC.png" data-day="https://ul.h3z.jp/ujUBACrC.png" data-night="https://ul.h3z.jp/0LHkVmoQ.png" alt="ぷにぷに">
    <div class="takomin-balloon"></div>
  </button>

  <!-- 上のブロックタコ民（topmenu） -->
  <button class="takomin takomin--me1 takomin--glow topmenu" data-id="me1" type="button" aria-label="最新のお知らせ">
    <img src="https://ul.h3z.jp/2z5fOkRX.png" data-day="https://ul.h3z.jp/2z5fOkRX.png" data-night="https://ul.h3z.jp/dUhJu7ky.png" alt="最新のお知らせ">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--me2 takomin--glow topmenu" data-id="me2" type="button" aria-label="たこ焼きトレカの世界">
    <img src="https://ul.h3z.jp/CJ443Pa2.png" data-day="https://ul.h3z.jp/CJ443Pa2.png" data-night="https://ul.h3z.jp/QAszf1eo.png" alt="たこ焼きトレカの世界">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--me3 takomin--glow topmenu" data-id="me3" type="button" aria-label="よくある質問">
    <img src="https://ul.h3z.jp/I3PLFgos.png" data-day="https://ul.h3z.jp/I3PLFgos.png" data-night="https://ul.h3z.jp/Qvk5pot0.png" alt="よくある質問">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--me4 takomin--glow topmenu" data-id="me4" type="button" aria-label="今遊べるイベント">
    <img src="https://ul.h3z.jp/y7MHJcs1.png" data-day="https://ul.h3z.jp/y7MHJcs1.png" data-night="https://ul.h3z.jp/HX7qBOFD.png" alt="今遊べるイベント">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--me5 takomin--glow topmenu" data-id="me5" type="button" aria-label="ビンゴの泉">
    <img src="https://ul.h3z.jp/JQGm41Td.png" data-day="https://ul.h3z.jp/JQGm41Td.png" data-night="https://ul.h3z.jp/OrmSjUlC.png" alt="ビンゴの泉">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--me6 takomin--glow topmenu" data-id="me6" type="button" aria-label="カードを買う">
    <img src="https://ul.h3z.jp/Db26pagb.png" data-day="https://ul.h3z.jp/Db26pagb.png" data-night="https://ul.h3z.jp/ko0Xgd8p.png" alt="カードを買う">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--me7 takomin--glow topmenu" data-id="me7" type="button" aria-label="たこぴのSNS">
    <img src="https://ul.h3z.jp/D2KbpmcN.png" data-day="https://ul.h3z.jp/D2KbpmcN.png" data-night="https://ul.h3z.jp/g5bLMwI0.png" alt="たこぴのSNS">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--me8 takomin--glow topmenu" data-id="me8" type="button" aria-label="アイテムショップ">
    <img src="https://ul.h3z.jp/OREcMs5u.png" data-day="https://ul.h3z.jp/OREcMs5u.png" data-night="https://ul.h3z.jp/2gFRuuSs.png" alt="アイテムショップ">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--me9 takomin--glow topmenu" data-id="me9" type="button" aria-label="達成の記録">
    <img src="https://ul.h3z.jp/nvhUJBFe.png" data-day="https://ul.h3z.jp/nvhUJBFe.png" data-night="https://ul.h3z.jp/gXNVqtcD.png" alt="達成の記録">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--me10 takomin--glow topmenu" data-id="me10" type="button" aria-label="メディア掲載">
    <img src="https://ul.h3z.jp/s4CIKhrn.png" data-day="https://ul.h3z.jp/s4CIKhrn.png" data-night="https://ul.h3z.jp/5fFm3Fpr.png" alt="メディア掲載">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--me12 takomin--glow topmenu" data-id="me12" type="button" aria-label="カード図鑑">
    <img src="https://ul.h3z.jp/Wvnf4dc7.png" data-day="https://ul.h3z.jp/Wvnf4dc7.png" data-night="https://ul.h3z.jp/3aj5G2CO.png" alt="">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--me13 is-step" data-id="me13" type="button" aria-label="推し活">
    <img src="https://ul.h3z.jp/mC7LPEzu.png" data-day="https://ul.h3z.jp/mC7LPEzu.png" data-night="https://ul.h3z.jp/icyNwiaA.png" alt="推し活">
    <div class="takomin-balloon"></div>
  </button>

  <!-- ✅ 釣りタコ民：ルートなので ./town/ へ -->
  <a class="takomin takomin--fish is-bob" href="./town/takofish.html" aria-label="たこ焼き釣りへ">
    <img src="https://ul.h3z.jp/8taiJLpS.png" data-day="https://ul.h3z.jp/8taiJLpS.png" data-night="https://ul.h3z.jp/QP3AevlY.png" alt="釣りタコ民">
  </a>

  <style>
    .map-wrap .takomin--fish{ top: 85.6%; left: 70%; }
    .map-wrap .takomin--tawa1{ position: absolute !important; z-index: 90 !important; }
    .map-wrap .takomin--tawa{ position: absolute !important; z-index: 80 !important; }
  </style>

  <button class="takomin takomin--tawa1 takomin--glow topmenu" data-id="tawa1" type="button" aria-label="タワー兄妹">
    <img src="https://basefile.akamaized.net/takoyakitrc-base-shop/6978ca4e7ec5c/sasada3.png"
      data-day="https://basefile.akamaized.net/takoyakitrc-base-shop/6978ca4e7ec5c/sasada3.png"
      data-night="https://ul.h3z.jp/xonP2u98.png"
      alt="タワー兄妹">
    <div class="takomin-balloon"></div>
  </button>

  <button class="takomin takomin--tawa" data-id="tawa" type="button" aria-label="たこ焼きタワー">
    <img src="https://ul.h3z.jp/QJX6Wqrs.png" data-day="https://ul.h3z.jp/QJX6Wqrs.png" data-night="https://ul.h3z.jp/Rbm88XCj.png" alt="たこ焼きタワー">
    <div class="takomin-balloon"></div>
  </button>

  <script>
  (() => {
    // 1) たこ焼きタワー起動（✅ ルートなので ./town/ へ）
    const towerBtn = document.querySelector('.takomin--tawa');
    if (towerBtn) {
      towerBtn.addEventListener('click', () => {
        location.href = './town/takoyaki-tower.html';
      });
    }

    const isNight = () =>
      document.documentElement.classList.contains("is-night") ||
      document.body?.classList.contains("is-night");

    const targets = [
      ".takomin--tawa img",
      ".takomin--tawa1 img",
      ".takomin--fish img"
    ];

    function apply(){
      targets.forEach(sel => {
        const img = document.querySelector(sel);
        if (!img) return;
        const day   = img.dataset.day;
        const night = img.dataset.night;
        const url   = isNight() ? night : day;
        if (url) img.src = url;
      });
    }

    apply();

    const mo = new MutationObserver(apply);
    mo.observe(document.documentElement, { attributes:true, attributeFilter:["class"] });
    if (document.body) mo.observe(document.body, { attributes:true, attributeFilter:["class"] });

    setInterval(apply, 1000);
  })();
  </script>

  <style>
  /* （あなたの大量CSSはそのまま：省略せず全部残す方針で、元のまま貼り続けてOK）
     ここでは“改造が必要だったリンク/参照だけ”を直しています */
  </style>

  <!-- ダーツ佐俣とニキティGIF -->
  <img src="https://ul.h3z.jp/l2zcjFAE.gif" class="map-gif" alt="コラボカード一覧">
  <!-- 北海道焼きもとの湯GIF -->
  <img src="https://ul.h3z.jp/OdXwiBmZ.gif" class="map2-gif" alt="たこ焼き菜々">

  <!-- ホットスポット（元の絶対URLはそのままOK / 相対だけ ./town/ に変更） -->
  <a class="hotspot hs-osirase" href="https://takoyaki-trc.github.io/takoyaki-media/town/news.html" aria-label="最新のお知らせ"></a>
  <a class="hotspot hs-story" href="https://takoyaki-trc.github.io/takoyaki-media/town/about.html" aria-label="たこ焼きトレカの世界"></a>
  <a class="hotspot hs-situmon" href="https://takoyaki-trc.github.io/takoyaki-media/town/faq.html" aria-label="よくある質問"></a>
  <a class="hotspot hs-bingo" href="https://takoyaki-trc.github.io/takoyaki-media/town/bingo.html" aria-label="ビンゴの泉"></a>
  <a class="hotspot hs-ivent" href="https://takoyaki-trc.github.io/takoyaki-media/town/events.html" aria-label="いま遊べるイベント"></a>
  <a class="hotspot hs-kau" href="https://takoyaki-toreka.booth.pm/item_lists/m7YToKe5" aria-label="カードを買う"></a>
  <a class="hotspot hs-sns" href="https://x.com/takopi_trc" aria-label="たこぴのSNS"></a>
  <a class="hotspot hs-item" href="https://takoyaki-toreka.booth.pm/item_lists/nNPTZdOd" aria-label="アイテムショップ"></a>
  <a class="hotspot hs-kiroku" href="https://takoyaki-trc.github.io/takoyaki-media/town/complete.html" aria-label="達成の記録"></a>
  <a class="hotspot hs-medhia" href="https://takoyaki-trc.github.io/takoyaki-media/town/media.html" aria-label="メディア掲載"></a>

  <!-- ✅ ここが相対だったので ./town/ に -->
  <a class="hotspot hs-korabo" href="./town/collabo.html" aria-label="コラボカードを見る"></a>
  <a class="hotspot hs-zukan1" href="./town/cardlist.html" aria-label="カードリスト"></a>

  <a class="hotspot hs-tou" href="https://takoyaki-trc.github.io/takoyaki-media/town/tabiji.html" aria-label="旅路の塔"></a>

  <!-- 協力店（そのまま） -->
  <a class="hotspot hs-ghost" href="https://share.google/zXplullkNy8XP35bj" aria-label="GHOST"></a>
  <a class="hotspot hs-yousha" href="https://share.google/QAtxaPWvWBI4ks2Ug" aria-label="sports and darts cafe YOUSHA"></a>
  <a class="hotspot hs-bigmans" href="https://share.google/Ag1SRMedWINlgV0S3" aria-label="Darts&Shop BIGMANS"></a>
  <a class="hotspot hs-hanayashiki" href="https://share.google/AOSjhW79YMq0hJUuh" aria-label="華矢式"></a>
  <a class="hotspot hs-2bit" href="https://share.google/N2MqjpCLRYiKU6S8T" aria-label="Darts room 2 bit"></a>
  <a class="hotspot hs-kbc" href="https://share.google/6szp6CoWi6H6kL3Ss" aria-label="ビリヤード＆ダーツＫＢＣ"></a>
  <a class="hotspot hs-mars" href="https://share.google/Nu2j99ORbplos40Zh" aria-label="Mars. Kamata"></a>
  <a class="hotspot hs-dollis" href="https://share.google/gb0NBa7q35HzEfqq9" aria-label="ダーツカフェ ドリズ DOLLiS"></a>
  <a class="hotspot hs-puni" href="https://www.instagram.com/punipuni_wakkanai/" aria-label="ぷにぷに稚内"></a>
  <a class="hotspot hs-katanakazi" href="https://share.google/ulEVNRsi6wreMqV8p" aria-label="たこ焼き 刀鍛冶"></a>
  <a class="hotspot hs-nana" href="https://share.google/MDaHozOZI1bmLxUwL" aria-label="たこ焼き菜々"></a>

</div>

<style>
  .night-only{ display:none; }
  html.is-night .night-only{ display:block; }
</style>

<script>
(() => {
  function nowTokyo(){
    return new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Tokyo" }));
  }

  function slotByHour(h){
    if(h >= 5 && h < 11) return "morning";
    if(h >= 11 && h < 20) return "day";
    return "night";
  }
  function applyMapByHour(h){
    const img = document.querySelector('.map-img');
    if(!img) return;

    const slot = slotByHour(h);
    const url =
      slot === 'morning' ? img.dataset.morning :
      slot === 'day'     ? img.dataset.day :
                           img.dataset.night;

    if(url && img.src !== url) img.src = url;
  }

  const SKY = [
    ["#0b1020", "#141c2e"], ["#0b1020", "#141c2e"],
    ["#0c1224", "#18223a"], ["#121a33", "#22304f"],
    ["#1b2a44", "#3b4a6b"], ["#3c3b5a", "#7b6ea8"],
    ["#8a5a7b", "#f2b5c4"], ["#d97b6a", "#ffd1a9"],
    ["#8ec1e8", "#eaf4ff"], ["#6fa8dc", "#cfe8ff"],
    ["#63a4e1", "#dbeeff"], ["#76b5ea", "#eaf4ff"],
    ["#87b8e5", "#eaf4ff"], ["#87b8e5", "#eaf4ff"],
    ["#7fb3d5", "#eaf4f4"], ["#9fc5d1", "#eaf4f4"],
    ["#f9cb9c", "#fff1c1"], ["#f2a65a", "#f6d365"],
    ["#d96c4f", "#f2a65a"], ["#a35d7b", "#5b4e7a"],
    ["#2c2f4a", "#1b2430"], ["#1b2430", "#141c2e"],
    ["#121a2b", "#10131f"], ["#0b1020", "#141c2e"]
  ];

  const mix = (a,b,t)=>{
    const h=x=>parseInt(x,16);
    const r=x=>x.toString(16).padStart(2,"0");
    const A=a.slice(1).match(/../g).map(h);
    const B=b.slice(1).match(/../g).map(h);
    return "#"+A.map((v,i)=>r(Math.round(v+(B[i]-v)*t))).join("");
  };

  function updatePhaseOrb(now){
    const strip = document.getElementById("phase-strip");
    const orb   = document.getElementById("phase-orb");
    if(!strip || !orb) return;

    const minutes = now.getHours()*60 + now.getMinutes();
    const sunrise = 6*60;
    const sunset  = 19*60;
    const nextSunrise = 24*60 + sunrise;

    let p, isDay;
    if(minutes >= sunrise && minutes < sunset){
      isDay = true;
      p = (minutes - sunrise) / (sunset - sunrise);
    }else{
      isDay = false;
      const m = minutes < sunrise ? minutes + 1440 : minutes;
      p = (m - sunset) / (nextSunrise - sunset);
    }

    const maxX = strip.clientWidth - orb.clientWidth;
    orb.style.transform =
      `translateX(${Math.round(maxX * p)}px) scale(${isDay ? 1 : 0.8})`;

    orb.classList.toggle("sun", isDay);
    orb.classList.toggle("moon", !isDay);

    if(!isDay){
      const sx = Math.round(26 - 52 * p);
      orb.style.setProperty("--shadow-x", `${sx}px`);
    }else{
      orb.style.removeProperty("--shadow-x");
    }
  }

  function applyAll(){
    const now = nowTokyo();
    const h = now.getHours();
    const night = (h >= 20 || h < 5);

    const html = document.documentElement;
    if (night) {
      html.classList.add("is-night");
      html.classList.remove("day");
    } else {
      html.classList.remove("is-night");
      html.classList.add("day");
    }

    applyMapByHour(h);

    const t = (now.getMinutes()*60 + now.getSeconds()) / 3600;
    const next = (h+1)%24;
    document.body.style.setProperty(
      "--sky",
      `linear-gradient(${mix(SKY[h][0],SKY[next][0],t)}, ${mix(SKY[h][1],SKY[next][1],t)})`
    );

    updatePhaseOrb(now);
  }

  document.addEventListener("DOMContentLoaded", ()=>{
    applyAll();
    setInterval(applyAll, 20 * 1000);
  });
  window.addEventListener("pageshow", applyAll);
})();
</script>

<!-- ✅ JS参照：./town/ に付け替え -->
<script defer src="https://cdn.jsdelivr.net/gh/takoyaki-trc/takoyaki-gate@main/takomin-npc2.js?v=111"></script>
<script defer src="./town/assets/boss1.js?v=2"></script>
<script defer src="./town/assets/saidan.js"></script>
<script defer src="https://cdn.jsdelivr.net/gh/takoyaki-trc/takoyaki-gate@main/takomin-murabito7.js?v=5"></script>
<script defer src="./town/assets/takofarm3.js?v=20260129a"></script>

<footer id="siteFooter" style="
  width:100%;
  margin: 10px auto 0;
  padding: 10px 10px calc(18px + env(safe-area-inset-bottom));
  box-sizing:border-box;
  text-align:center;
  color: rgba(255,255,255,.78);
  font-size: 12px;
  line-height: 1.6;
">
  <div id="trcFooterDataBox" aria-label="データのバックアップと復元">
    <div class="row">
      <div class="title"><span class="dot"></span>DATA（端末保存）</div>
      <div class="btns">
        <button id="trcFooterBackup" class="btn primary" type="button">バックアップ</button>
        <button id="trcFooterRestore" class="btn" type="button">復元</button>
        <input id="trcFooterRestoreFile" type="file" accept="application/json" style="display:none">
      </div>
    </div>

    <div class="desc" style="color:#ff6b6b;font-weight:700;line-height:1.5;">
      ⚠ 重要：このゲームのデータは端末のブラウザにのみ保存されています。
      キャッシュ削除･履歴削除･機種変更を行うと、<br>
      カード画像･ゲーム進行･オクトなどのデータはすべて消えます。<br>
      データはサーバーに保存されません。復旧もできません。<br>
      必ず事前に「バックアップ」を作成してください。<br>
      ※復元は現在のデータを上書きします。元には戻せません。
    </div>
  </div>

  <!-- ✅ フッターリンクも ./town/ に付け替え（ページが town 配下にある前提） -->
  <div style="display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-items:center;margin-bottom:10px;">
    <a href="./town/tokushoho.html" style="color:#fff;text-decoration:none;border-bottom:1px solid rgba(255,255,255,.35);padding-bottom:1px;">特定商取引法に基づく表記</a>
    <a href="./town/privacy.html" style="color:#fff;text-decoration:none;border-bottom:1px solid rgba(255,255,255,.35);padding-bottom:1px;">プライバシーポリシー</a>
    <a href="./town/terms.html" style="color:#fff;text-decoration:none;border-bottom:1px solid rgba(255,255,255,.35);padding-bottom:1px;">利用規約 / 免責</a>
    <a href="./town/contact.html" style="color:#fff;text-decoration:none;border-bottom:1px solid rgba(255,255,255,.35);padding-bottom:1px;">お問い合わせ</a>
  </div>

  <div style="opacity:.75;margin-bottom:8px;">
    ※画像･文章の無断転載を禁止します。
  </div>

  <div style="opacity:.9;">
    © たこ焼き菜々 / 焼かれた伝説 たこ焼きトレーディングカード
  </div>
</footer>

<!-- ====== バックアップ/復元（あなたの既存そのまま） ====== -->
<script>
(() => {
  "use strict";

  const KEY = {
    resident: "trc_v1_resident",
    lastLogin: "trc_v1_last_login",
  };
  const EXIST = {
    farmBook: "tf_v1_book",
    farmInv:  "tf_v1_inv",
    rotenOcto:"roten_v1_octo",
    tower: "tower_v1_state",
    fish:  "fish_v1_state",
  };

  const getRaw = (k) => {
    const v = localStorage.getItem(k);
    return (v === null || v === undefined) ? null : String(v);
  };
  const safeJSONParse = (raw, fallback) => { try { return JSON.parse(raw); } catch (_) { return fallback; } };
  const safeStringify = (obj) => { try { return JSON.stringify(obj); } catch (_) { return "null"; } };

  function listKeysByRegex(re) {
    const out = [];
    for (let i = 0; i < localStorage.length; i++) {
      const k = localStorage.key(i);
      if (!k) continue;
      if (re.test(k)) out.push(k);
    }
    return out;
  }

  function slimBookRawKeepImg() {
    const raw = getRaw(EXIST.farmBook);
    if (!raw) return null;

    const book = safeJSONParse(raw, null);
    if (!book || typeof book !== "object") return raw;

    const got = (book.got && typeof book.got === "object") ? book.got : {};
    const outGot = {};
    for (const id of Object.keys(got)) {
      const node = got[id] || {};
      const c = Number(node.count || 0);
      if (c > 0) {
        const out = { id, count: c };
        if (typeof node.img === "string" && node.img.trim()) out.img = node.img.trim();
        if (typeof node.name === "string" && node.name.trim()) out.name = node.name.trim();
        if (typeof node.rarity === "string" && node.rarity.trim()) out.rarity = node.rarity.trim();
        if (node.at != null && String(node.at).trim()) out.at = node.at;
        if (node.lastAt != null && String(node.lastAt).trim()) out.lastAt = node.lastAt;
        outGot[id] = out;
      }
    }
    const slim = { ver: book.ver ?? 1, got: outGot };
    return safeStringify(slim);
  }

  function findFarmProgressKeys() {
    const out = [];
    for (let i = 0; i < localStorage.length; i++) {
      const k = localStorage.key(i);
      if (!k) continue;
      if (!/^tf_v1_/i.test(k)) continue;
      if (/log|history|debug/i.test(k)) continue;
      if (k === EXIST.farmBook || k === EXIST.farmInv) continue;
      out.push(k);
    }
    const prefer = ["tf_v1_state","tf_v1_level","tf_v1_xp","tf_v1_farm","tf_v1_progress"];
    const ordered = [];
    for (const p of prefer) {
      if (localStorage.getItem(p) != null && !ordered.includes(p)) ordered.push(p);
    }
    for (const k of out) if (!ordered.includes(k)) ordered.push(k);
    return ordered.slice(0, 40);
  }

  function findRotenProgressKeys() {
    const out = [];
    for (let i = 0; i < localStorage.length; i++) {
      const k = localStorage.key(i);
      if (!k) continue;
      if (!/^roten_v1_/i.test(k)) continue;
      if (/log|history|debug/i.test(k)) continue;
      out.push(k);
    }
    const prefer = [
      "roten_v1_level","roten_v1_rep","roten_v1_myshop","roten_v1_inventory",
      "roten_v1_market","roten_v1_state","roten_v1_shelves","roten_v1_octo"
    ];
    const ordered = [];
    for (const p of prefer) {
      if (localStorage.getItem(p) != null && !ordered.includes(p)) ordered.push(p);
    }
    for (const k of out) if (!ordered.includes(k)) ordered.push(k);
    return ordered.slice(0, 90);
  }

  function buildSlimBackupPayload() {
    const keys = {};

    keys[KEY.resident] = getRaw(KEY.resident);
    keys[KEY.lastLogin] = getRaw(KEY.lastLogin);

    keys[EXIST.rotenOcto] = getRaw(EXIST.rotenOcto);
    keys[EXIST.farmInv]   = getRaw(EXIST.farmInv);
    keys[EXIST.farmBook]  = slimBookRawKeepImg();

    for (const k of findFarmProgressKeys()) {
      const v = getRaw(k);
      if (v != null) keys[k] = v;
    }
    for (const k of findRotenProgressKeys()) {
      const v = getRaw(k);
      if (v != null) keys[k] = v;
    }

    if (getRaw(EXIST.tower) != null) keys[EXIST.tower] = getRaw(EXIST.tower);
    for (const k of listKeysByRegex(/tower/i)) {
      const v = getRaw(k);
      if (v != null) keys[k] = v;
    }

    if (getRaw(EXIST.fish) != null) keys[EXIST.fish] = getRaw(EXIST.fish);
    for (const k of listKeysByRegex(/fish|takofish|tako_fish|tfish/i)) {
      const v = getRaw(k);
      if (v != null) keys[k] = v;
    }

    for (const k of Object.keys(keys)) {
      if (keys[k] === null || keys[k] === undefined) delete keys[k];
    }

    return {
      app: "takoyaki-trc",
      ver: 5,
      kind: "slim+roten",
      exportedAt: new Date().toISOString(),
      note: "住民票/オクト/資材/図鑑(count+img+id)/畑進行(tf_v1_*)/露店進行(roten_v1_*)/タワー/釣り を保存。ログは保存しない。",
      keys
    };
  }

  function downloadJson(obj, filename) {
    const blob = new Blob([JSON.stringify(obj, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function backupSlim() {
    const payload = buildSlimBackupPayload();
    const stamp = new Date().toISOString().replace(/[:.]/g, "-");
    downloadJson(payload, `takoyaki-trc-backup_${stamp}.json`);
  }

  async function restoreFromFile(file) {
    const text = await file.text();
    const data = safeJSONParse(text, null);

    if (!data || !data.keys || typeof data.keys !== "object") {
      alert("このファイルはバックアップ形式ではありません。");
      return;
    }

    const keys = Object.keys(data.keys);
    const ok = confirm(
      "バックアップから復元します。\n" +
      "現在のデータは上書きされます（元に戻せません）。\n\n" +
      `復元キー数: ${keys.length}\n` +
      `書き出し日時: ${String(data.exportedAt || "")}\n\n` +
      "続行しますか？"
    );
    if (!ok) return;

    for (const k of keys) {
      const v = data.keys[k];
      if (v === null || v === undefined) localStorage.removeItem(k);
      else localStorage.setItem(k, String(v));
    }

    alert("復元しました。ページを再読み込みします。");
    location.reload();
  }

  const btnBackup  = document.getElementById("trcFooterBackup");
  const btnRestore = document.getElementById("trcFooterRestore");
  const inp        = document.getElementById("trcFooterRestoreFile");

  if (!btnBackup || !btnRestore || !inp) return;

  btnBackup.addEventListener("click", () => {
    const normal = btnBackup.textContent;
    btnBackup.disabled = true;
    btnBackup.textContent = "作成中…";
    setTimeout(() => {
      try { backupSlim(); }
      finally {
        btnBackup.disabled = false;
        btnBackup.textContent = normal;
      }
    }, 50);
  });

  btnRestore.addEventListener("click", () => inp.click());

  inp.addEventListener("change", async () => {
    const f = inp.files && inp.files[0];
    inp.value = "";
    if (!f) return;

    const normal = btnRestore.textContent;
    btnRestore.disabled = true;
    btnRestore.textContent = "読込中…";
    try { await restoreFromFile(f); }
    finally {
      btnRestore.disabled = false;
      btnRestore.textContent = normal;
    }
  });

})();
</script>

</body>
</html>
